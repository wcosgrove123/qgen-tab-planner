<!doctype html>
<html lang="en" data-theme="cue-light">
<head>
  <meta charset="utf-8" />
  <title>Q-Gen -- Questionnaire & Tab Plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/icons/Cue Logo 2.png" type="image/png" sizes="24x24">
  
  <script>
    // Initialize global state objects immediately so they are available to all modules.
    window.state = {};
    window.ui_state = {
      organization_id: null,
      active_project_id: null,
      active_question_index: null,
      active_tab: 'main',
      route: location.hash || '#/dashboard',
      active_prefield_tab: 'screener',
      base_builders: {}
    };
  </script>

  <style>
  /* ===================================================================
      Q-GEN STYLESHEET (REORGANIZED)
      ===================================================================
      This stylesheet has been refactored for clarity and organization.
      It follows a logical progression from foundational settings to
      specific component styles.

      -- CONTENTS --
      1.  Design Tokens (Brand Colors, Theme Variables, etc.)
      2.  Global Styles (Resets, Typography, Base Body Layout)
      3.  Generic Utilities (Helpers like .is-hidden, .muted, etc.)
      4.  Layout Primitives (Containers like .app-grid, .stack, etc.)
      5.  Base Element Styles (Default styles for button, input, etc.)
      6.  App Chrome (Header, Main Navigation, Sidebar)
      7.  Core Components (Cards, Modals, Pills, Menus, etc.)
      8.  Page-Specific Styles (Dashboard, Project Manager, Editor)
      9.  Legacy or Feature-Specific Styles (Preview & Banner Builder)
      10. Accessibility & Overrides
    =================================================================== */

  /* ===================================================================
    1. DESIGN TOKENS
    - Brand Palette (Stable Base)
    - Theme Variables (Light, Dark, Gold)
    - Sizing & Spacing
    =================================================================== */

  /* --- Brand Palette (Core Colors) --- */
  :root {
    --brand-primary:   #212161;  /* deep navy */
    --brand-secondary: #F2B800;  /* gold */
    --brand-yellow:    #F4E412;
    --brand-blue-1:    #3F6AB7;
    --brand-blue-2:    #335899;
    --brand-accent-1:  #A7B5DB;  /* soft periwinkle */
    --brand-accent-2:  #8197D0;
    --brand-accent-3:  #E3EAF7;  /* light panel */
    --danger:          #C62828;
  }

  /* --- Sizing & Spacing Tokens --- */
  :root {
    --radius-sm: 8px;
    --radius-md: 10px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --space-1: 6px;
    --space-2: 8px;
    --space-3: 10px;
    --space-4: 12px;
    --space-5: 14px;
    --space-6: 16px;
  }

  /* --- Theme: Cue Light (Default) --- */
  :root,
  :root[data-theme="cue-light"] {
    --accent:       var(--brand-primary);
    --accent-weak:  #3b3b7d;
    --cta:          var(--brand-secondary);
    --cta-text:     #1a1a1a;
    --bg:
      linear-gradient(135deg, #F8FAFF 0%, #E6F0FE 25%, #D8E8FD 50%, #E2ECFC 75%, #EAF2FB 100%),
      radial-gradient(circle at 20% 20%, rgba(70, 103, 165, 0.08) 0%, transparent 60%),
      radial-gradient(circle at 80% 80%, rgba(54, 78, 130, 0.06) 0%, transparent 60%),
      radial-gradient(circle at 50% 0%, rgba(70, 103, 165, 0.04) 0%, transparent 70%);
    --surface-3:    #F1F4FB;
    --surface-2:    #F6F8FD;
    --surface-1:    #FFFFFF;
    --fg:           #0F172A;
    --muted:        #637189;
    --line:         #D9E0EF;
    --ring:         rgba(51, 88, 153, .35);
    --shadow:       0 8px 24px rgba(70, 103, 165, .08), 0 2px 8px rgba(54, 78, 130, .04);
    --shadow-sm:    0 2px 8px rgba(70, 103, 165, .06);
    --shadow-lg:    0 12px 32px rgba(70, 103, 165, .12), 0 4px 12px rgba(54, 78, 130, .06);
    --shadow-xl:    0 20px 40px rgba(70, 103, 165, .15), 0 8px 16px rgba(54, 78, 130, .08);
  }

  /* --- Theme: Cue Dark --- */
  :root[data-theme="cue-dark"] {
    --accent:       #A7B5DB;
    --accent-weak:  #8ea1da;
    --cta:          var(--brand-secondary);
    --cta-text:     #101010;
    --bg:           #0A0F24;
    --surface-3:    #101631;
    --surface-2:    #131A35;
    --surface-1:    #151F41;
    --fg:           #E7ECFF;
    --muted:        #A8B2CC;
    --line:         rgba(231, 236, 255, .10);
    --ring:         rgba(167, 181, 219, .45);
    --shadow:       0 10px 28px rgba(0, 0, 0, .35), 0 4px 12px rgba(0, 0, 0, .15);
    --shadow-sm:    0 4px 12px rgba(0, 0, 0, .25);
    --shadow-lg:    0 16px 40px rgba(0, 0, 0, .45), 0 6px 16px rgba(0, 0, 0, .25);
    --shadow-xl:    0 24px 48px rgba(0, 0, 0, .55), 0 10px 20px rgba(0, 0, 0, .35);
  }

  /* --- Theme: Cue Gold --- */
  :root[data-theme="cue-gold"] {
    --cta:        var(--brand-secondary);
    --cta-text:   #1a1a1a;
  }


  /* ===================================================================
    2. GLOBAL STYLES
    - CSS Resets
    - Body & Typography Defaults
    =================================================================== */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  body {
    margin: 0;
    font: 14px/1.45 'Aptos', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color: var(--fg);
    background: var(--bg);
    background-attachment: fixed;
    display: flex;
    flex-direction: column;
    padding-bottom: 70px; /* A little extra space */
    min-height: 100vh;
  }

  /* Special body class for the Gold theme to override buttons */
  body.gold-all button:not(.danger) {
    background: var(--cta) !important;
    border-color: var(--cta) !important;
    color: var(--cta-text) !important;
  }

  /* ADD THIS to make your new editor look like a text field */
  [contenteditable="true"].form-control {
    border: 1px solid var(--line);
    transition: box-shadow .15s, border-color .15s, background .15s;
    padding: 16px;
  }

  /* ADD THIS to simulate placeholder text */
  [contenteditable="true"].form-control:empty::before {
    content: 'Enter question text...';
    color: var(--muted);
    pointer-events: none; /* Allows you to click "through" the placeholder */
  }

  .modern-footer {
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    background-color: #2c3e50; /* A dark slate blue - adjust to your brand */
    color: white;
    padding: 15px 0;
    font-family: 'Segoe UI', Tahoma, sans-serif; /* A modern font */
  }

  .modern-footer .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px; /* Adjust max-width as needed */
      margin: 0 auto;
      padding: 0 25px;
  }

  .modern-footer .app-name {
      font-weight: bold;
      font-size: 1.1em;
  }

  .modern-footer .company-link a {
      color: #ffffff;
      text-decoration: none;
      opacity: 0.8;
      transition: opacity 0.2s ease-in-out;
  }

  .modern-footer .company-link a:hover {
      opacity: 1;
  }

  .comprehensive-footer {
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    background-color: #ffffff; /* Clean white background */
    color: #555555; /* Soft black text */
    padding: 10px 0;
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    border-top: 1px solid #ddd;
    font-size: 0.85em;
  }

  .comprehensive-footer .footer-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 25px;
  }

  .comprehensive-footer .footer-left a {
      color: #005A9C; /* Your brand's accent color */
      text-decoration: none;
      font-weight: 600;
  }

  .comprehensive-footer .footer-left a:hover {
      text-decoration: underline;
  }

  .comprehensive-footer .footer-right {
      display: flex;
      align-items: center;
  }

  .comprehensive-footer .social-icon {
      margin-left: 15px;
      color: #555555;
      opacity: 0.7;
      transition: opacity 0.2s ease-in-out;
  }

  .comprehensive-footer .social-icon:hover {
      opacity: 1;
  }

  .app-footer-zoned {
    position: fixed;
    left: 0;
    bottom: 0;
    width: 100%;
    padding: 15px 25px;
    background-color: #FFFFFF;
    border-top: 1px solid #EAECF0;
    color: #6C757D;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    font-size: 13px;
  }

  .app-footer-zoned .footer-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1800px; /* Adjusted to match app's max width */
      margin: 0 auto;
  }

  .app-footer-zoned a {
      color: #6C757D;
      text-decoration: none;
  }

  .app-footer-zoned a:hover {
      color: #4A5A94; /* Accent color on hover */
      text-decoration: underline;
  }

  .app-footer-zoned .footer-left a {
      color: #4A5A94;
      font-weight: 500;
  }

  .app-footer-zoned .footer-right {
      display: flex;
      align-items: center;
      gap: 20px; /* Creates space between the links */
  }


  /* ===================================================================
    3. GENERIC UTILITIES
    - Common helper classes for visibility, color, etc.
    =================================================================== */
  .is-hidden {
    display: none;
  }

  /* Special smooth animation for advanced options panels */
  .advanced-options.is-hidden {
    max-height: 0 !important;
    opacity: 0 !important;
    margin-top: 0 !important;
    padding-top: 0 !important;
    padding-bottom: 0 !important;
    transition: max-height 0.3s ease-out, opacity 0.2s ease-out, margin-top 0.3s ease-out !important;
  }

  .muted {
    color: var(--muted);
  }

  .mono {
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }

  .content-blur {
    filter: blur(4px);
    transition: filter .2s ease-out;
  }

  .ok {
    color: #16a34a;
    font-size: 12px;
  }

  .error {
    margin: 16px;
    white-space: pre-wrap;
    color: #7f1d1d;
    background: #fef2f2;
    border: 1px solid #fecaca;
    padding: 10px;
    border-radius: 8px;
  }


  /* ===================================================================
    4. LAYOUT PRIMITIVES
    - Reusable layout containers like grids and stacks.
    =================================================================== */
  main#view-root {
    flex: 1;
    overflow: auto;
    padding: 0;
    margin: 0;
  }

  /* Main 2-column layout for the editor */
  .app-grid {
    display: grid;
    grid-template-columns: 360px minmax(0, 1fr);
    gap: 16px;
    padding: 16px;
    flex-grow: 1;
    overflow: hidden;
  }

  .left-panel,
  .right-panel {
    display: flex;
    flex-direction: column;
    gap: 12px;
    min-width: 0;
    overflow-y: auto;
    overflow-x: hidden;
  }

  .left-panel {
    flex: 0 0 360px; /* Explicit size for left panel */
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 12px;
    box-shadow: var(--shadow);
  }


  .right-panel-content {
    flex-grow: 1;
  }

  /* ================================= */
  /* REPORTING INTERFACE STYLES       */
  /* ================================= */

  .reporting-workspace {
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  .reporting-header {
    background: var(--surface);
    border-bottom: 1px solid var(--line);
    padding: 16px;
    flex-shrink: 0;
  }

  .data-import-panel h3 {
    margin: 0 0 16px 0;
    color: var(--fg);
    font-size: 18px;
    font-weight: 600;
  }

  .import-controls {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }

  .file-upload-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .file-upload-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    background: var(--accent);
    color: white;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
  }

  .file-upload-btn:hover {
    background: var(--accent-strong);
    transform: translateY(-1px);
  }

  .upload-status {
    font-size: 12px;
    color: var(--muted);
    margin-left: 8px;
  }

  .upload-status.file-selected {
    color: var(--accent);
    font-weight: 500;
  }

  .data-summary {
    margin-top: 16px;
    padding: 16px;
    background: var(--surface-2);
    border-radius: var(--radius);
    border: 1px solid var(--line);
  }

  .summary-stats {
    display: flex;
    gap: 24px;
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .stat-label {
    font-size: 12px;
    color: var(--muted);
    text-transform: uppercase;
    font-weight: 600;
  }

  .stat-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--fg);
  }

  .stat-value.status-ready {
    color: var(--success);
  }

  .reporting-main {
    display: flex;
    flex: 1;
    overflow: hidden;
    gap: 16px;
    padding: 16px;
  }

  /* Question Palette */
  .question-palette {
    width: 300px;
    background: var(--surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--line);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .palette-header {
    padding: 16px;
    border-bottom: 1px solid var(--line);
    background: var(--surface-2);
  }

  .palette-header h4 {
    margin: 0 0 12px 0;
    color: var(--fg);
    font-size: 16px;
    font-weight: 600;
  }

  .palette-filters {
    display: flex;
    gap: 4px;
  }

  .filter-btn {
    padding: 6px 12px;
    border: 1px solid var(--line);
    background: var(--surface);
    color: var(--muted);
    border-radius: var(--radius);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .filter-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .filter-btn:hover:not(.active) {
    background: var(--surface-2);
    color: var(--fg);
  }

  .palette-content {
    flex: 1;
    overflow-y: auto;
    padding: 12px;
  }

  .question-item {
    padding: 12px;
    border: 1px solid var(--line);
    border-radius: var(--radius);
    margin-bottom: 0;
    background: var(--surface);
    cursor: grab;
    transition: all 0.2s ease;
  }

  .question-item:hover {
    border-color: var(--accent);
    background: var(--surface-2);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .question-item.draggable:active {
    cursor: grabbing;
    transform: scale(0.98);
  }

  .question-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .question-id {
    font-weight: 700;
    color: var(--accent);
    font-size: 14px;
  }

  .question-type-badge {
    padding: 2px 6px;
    border-radius: var(--radius);
    font-size: 12px;
    background: var(--surface-3);
    color: var(--muted);
  }

  .question-text {
    color: var(--fg);
    font-size: 13px;
    line-height: 1.4;
    margin-bottom: 8px;
  }

  .question-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 11px;
  }

  .sub-questions {
    background: var(--warning-weak);
    color: var(--warning);
    padding: 2px 6px;
    border-radius: var(--radius);
    font-weight: 600;
  }

  .section-badge {
    padding: 2px 6px;
    border-radius: var(--radius);
    font-weight: 600;
    text-transform: uppercase;
  }

  .section-badge.screener {
    background: var(--info-weak);
    color: var(--info);
  }

  .section-badge.main {
    background: var(--success-weak);
    color: var(--success);
  }

  /* Chart Canvas */
  .chart-canvas {
    flex: 1;
    background: var(--surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--line);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .canvas-header {
    padding: 16px;
    border-bottom: 1px solid var(--line);
    background: var(--surface-2);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .canvas-header h4 {
    margin: 0;
    color: var(--fg);
    font-size: 16px;
    font-weight: 600;
  }

  .canvas-controls {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .canvas-content {
    flex: 1;
    overflow: auto;
    position: relative;
  }

  .canvas-placeholder {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--surface-2);
    border: 2px dashed var(--line);
    margin: 16px;
    border-radius: var(--radius-lg);
    transition: all 0.3s ease;
  }

  .canvas-content.drag-over .canvas-placeholder {
    border-color: var(--accent);
    background: var(--accent-weak);
  }

  .placeholder-content {
    text-align: center;
    color: var(--muted);
  }

  .placeholder-icon {
    font-size: 64px;
    margin-bottom: 16px;
  }

  .placeholder-content h3 {
    margin: 0 0 8px 0;
    color: var(--fg);
    font-size: 20px;
  }

  .placeholder-content p {
    margin: 0 0 24px 0;
    color: var(--muted);
  }

  .drop-zone-hints {
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-size: 13px;
  }

  .hint-item {
    padding: 8px 12px;
    background: var(--surface-3);
    border-radius: var(--radius);
    color: var(--muted);
  }

  /* Banner Palette */
  .banner-palette {
    width: 280px;
    background: var(--surface);
    border-radius: var(--radius-lg);
    border: 1px solid var(--line);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .banner-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--muted);
  }

  .toggle-switch {
    position: relative;
    display: inline-block;
    width: 40px;
    height: 20px;
  }

  .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }

  .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--line);
    transition: 0.3s;
    border-radius: 20px;
  }

  .toggle-slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    transition: 0.3s;
    border-radius: 50%;
  }

  input:checked + .toggle-slider {
    background-color: var(--accent);
  }

  input:checked + .toggle-slider:before {
    transform: translateX(20px);
  }

  .banner-item {
    padding: 12px;
    border: 1px solid var(--line);
    border-radius: var(--radius);
    margin-bottom: 8px;
    background: var(--surface);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .banner-item:hover {
    border-color: var(--accent);
    background: var(--surface-2);
  }

  .banner-item.selected {
    border-color: var(--accent);
    background: var(--accent-weak);
  }

  .banner-icon {
    font-size: 20px;
  }

  .banner-text {
    flex: 1;
    color: var(--fg);
    font-size: 13px;
    font-weight: 500;
  }

  .banner-id {
    color: var(--muted);
    font-size: 11px;
    font-weight: 600;
  }

  /* Chart Customization */
  .chart-customization {
    margin-top: 16px;
    padding: 16px;
    border-top: 1px solid var(--line);
    background: var(--surface-2);
  }

  .chart-customization h5 {
    margin: 0 0 16px 0;
    color: var(--fg);
    font-size: 14px;
    font-weight: 600;
  }

  .customization-controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .control-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .control-group label {
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
  }

  .color-picker-group {
    display: flex;
    gap: 8px;
  }

  .color-picker-group input[type="color"] {
    width: 40px;
    height: 32px;
    border: 1px solid var(--line);
    border-radius: var(--radius);
    cursor: pointer;
    background: none;
  }

  .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .checkbox-group label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--fg);
    text-transform: none;
    font-weight: normal;
    cursor: pointer;
  }

  .checkbox-group input[type="checkbox"] {
    margin: 0;
  }

  /* Chart Visualizations */
  .chart-visualization {
    padding: 24px;
    background: white;
    border-radius: var(--radius-lg);
    margin: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border: 1px solid var(--line);
  }

  .chart-title {
    font-size: 18px;
    font-weight: 700;
    color: #333;
    margin-bottom: 20px;
    text-align: center;
  }

  .chart-content {
    margin-bottom: 16px;
  }

  .chart-footer {
    text-align: center;
    padding-top: 16px;
    border-top: 1px solid #eee;
    color: #666;
  }

  /* Multi-Likert Chart Styles - Professional Reference Match */
  .multi-likert {
    background: #ffffff;
    padding: 24px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  .multi-likert .chart-header {
    margin-bottom: 24px;
    text-align: center;
  }

  .multi-likert .chart-header h3 {
    font-size: 28px;
    font-weight: 400;
    color: #F2B800;
    margin: 0 0 8px 0;
    letter-spacing: 0.02em;
  }

  .multi-likert .chart-subtitle {
    font-size: 18px;
    color: #333;
    font-weight: 400;
    margin-bottom: 16px;
  }

  /* Professional Table Layout */
  .likert-statements {
    display: table;
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    margin-bottom: 20px;
  }

  .statement-header {
    display: table-row;
    background: #f8f9fa;
  }

  .statement-header-cell {
    display: table-cell;
    padding: 12px 16px;
    font-weight: 600;
    color: #333;
    border: 1px solid #ddd;
    text-align: center;
    vertical-align: middle;
  }

  .statement-header-cell:first-child {
    text-align: left;
    width: 40%;
  }

  .statement-header-cell.b2b-header {
    background: #F2B800;
    color: white;
  }

  .statement-header-cell.t2b-header {
    background: #2c5aa0;
    color: white;
  }

  .statement-row {
    display: table-row;
    border-bottom: 1px solid #e5e5e5;
  }

  .statement-row:hover {
    background: #f8f9fa;
  }

  .statement-cell {
    display: table-cell;
    padding: 12px 16px;
    border: 1px solid #ddd;
    vertical-align: middle;
  }

  .statement-text {
    font-size: 14px;
    color: #333;
    line-height: 1.4;
    text-align: left;
    width: 40%;
  }

  .statement-chart {
    width: 45%;
    position: relative;
  }

  /* Professional Horizontal Stacked Bar */
  .likert-scale {
    width: 100%;
    height: 28px;
    display: flex;
    border: 1px solid #d1d5db;
    background: #ffffff;
    overflow: hidden;
  }

  .likert-bar {
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1f2937;
    font-size: 11px;
    font-weight: 700;
    position: relative;
    margin: 0;
    border: none;
    border-radius: 0;
  }

  .likert-bar:not(:last-child) {
    border-right: 1px solid rgba(255,255,255,0.6);
  }

  .bar-label {
    font-weight: 700;
    color: #1f2937;
    text-shadow: none;
    letter-spacing: 0.02em;
  }

  /* Professional Clean Colors - Exact Match */
  .likert-bar.strongly-agree { background-color: #fef3c7; border-radius: 0; } /* Very light yellow */
  .likert-bar.agree { background-color: #fcd34d; border-radius: 0; } /* Light yellow */
  .likert-bar.neither { background-color: #f59e0b; border-radius: 0; } /* Medium orange */
  .likert-bar.disagree { background-color: #d97706; border-radius: 0; } /* Dark orange */
  .likert-bar.strongly-disagree { background-color: #b45309; border-radius: 0; } /* Very dark orange */

  .statement-metrics {
    display: table-cell;
    text-align: center;
    vertical-align: middle;
    padding: 12px 16px;
    border: 1px solid #ddd;
    font-size: 14px;
    font-weight: 600;
    width: 7.5%;
  }

  .t2b-cell {
    background: #E5E7EB;
    color: #333;
  }

  .b2b-cell {
    background: #F2B800;
    color: white;
  }

  /* Scale Legend */
  .chart-legend {
    display: flex;
    justify-content: center;
    gap: 24px;
    padding: 16px 0;
    font-size: 12px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .legend-item::before {
    content: '';
    width: 16px;
    height: 16px;
    border: 1px solid #ccc;
  }

  .legend-item.strongly-agree::before { background-color: #fef3c7; }
  .legend-item.agree::before { background-color: #fcd34d; }
  .legend-item.neither::before { background-color: #f59e0b; }
  .legend-item.disagree::before { background-color: #d97706; }
  .legend-item.strongly-disagree::before { background-color: #b45309; }

  /* Likert Chart */
  .likert-bars {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .likert-bar-row {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .likert-label {
    width: 200px;
    font-size: 13px;
    color: #555;
    text-align: right;
    flex-shrink: 0;
  }

  .likert-bar {
    flex: 1;
    height: 32px;
    background: #f5f5f5;
    border-radius: 16px;
    position: relative;
    overflow: hidden;
  }

  .bar-fill {
    height: 100%;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 600;
    transition: width 0.8s ease;
  }

  /* Bar Chart */
  .bar-chart-container {
    display: flex;
    align-items: end;
    justify-content: center;
    gap: 16px;
    height: 300px;
    padding: 20px 0;
  }

  .bar-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    min-width: 80px;
  }

  .bar {
    width: 60px;
    background: var(--accent);
    border-radius: 4px 4px 0 0;
    display: flex;
    align-items: end;
    justify-content: center;
    padding: 8px 4px;
    min-height: 20px;
    transition: height 0.8s ease;
    position: relative;
  }

  .bar-value {
    color: white;
    font-size: 11px;
    font-weight: 600;
    text-align: center;
    line-height: 1.2;
  }

  .bar-label {
    font-size: 12px;
    color: #555;
    text-align: center;
    max-width: 80px;
    line-height: 1.3;
  }

  /* Numeric Chart */
  .numeric-summary {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 24px;
  }

  .summary-stat {
    text-align: center;
  }

  .summary-stat .stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 4px;
  }

  .summary-stat .stat-label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    font-weight: 600;
  }

  /* General purpose flexbox row */
  .stack {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
  }

  /* General purpose grid for cards, etc. */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 12px;
  }

  /* For simple key-value rows in the editor */
  .row {
    display: grid;
    grid-template-columns: 140px minmax(0, 1fr);
    gap: 10px;
    margin: 10px 0;
    align-items: start;
  }


  /* ===================================================================
    5. BASE ELEMENT STYLES
    - Default styling for forms, buttons, etc.
    =================================================================== */
  input,
  select,
  textarea {
    width: 100%;
    max-width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--line);
    border-radius: 10px;
    background: var(--surface-1);
    color: var(--fg);
    outline: none;
    font-family: inherit;
    font-size: 14px;
    transition: box-shadow .15s, border-color .15s, background .15s;
  }

  input:focus,
  select:focus,
  textarea:focus {
    box-shadow: 0 0 0 3px var(--ring);
    border-color: transparent;
  }

  textarea {
    min-height: 70px;
    resize: vertical;
  }

  button {
    font-family: inherit;
    font-size: 14px;
    padding: 8px 12px;
    border-radius: 10px;
    border: 1px solid var(--line);
    background: var(--surface-1);
    color: var(--fg);
    cursor: pointer;
    transition: filter .12s, background .12s, border-color .12s;
    max-width: 100%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }

  button:hover {
    filter: brightness(0.98);
  }

  button.primary,
  .btn.primary {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
  }

  button.danger,
  .btn.danger {
    border-color: var(--danger);
    color: var(--danger);
  }

  .btn.ghost {
    background: transparent;
  }

  .btn.ghost.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .icon-btn {
    all: unset;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }


  /* ===================================================================
    6. APP CHROME
    - Header, Main Navigation, Sidebar/Drawer
    =================================================================== */

  /* --- Main Header --- */
  header {
    background: linear-gradient(135deg, var(--brand-primary) 0%, var(--brand-blue-2) 50%, var(--brand-blue-1) 100%);
    border-bottom: 3px solid var(--brand-secondary);
    padding: 16px 24px;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    flex-shrink: 0;
    box-shadow: 0 6px 20px rgba(33, 33, 97, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1);
    position: relative;
    z-index: 101; /* Above sidebar backdrop */
    min-height: 72px;
  }

  header .logo {
    height: 48px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
  }

  header .logo:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transform: scale(1.05);
  }

  header #logo-link {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 22px;
    font-weight: 700;
    color: white;
    text-decoration: none;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
    grid-column: 2; /* Place in center column */
    justify-self: center; /* Center within the grid column */
  }

  header #logo-link:hover {
    transform: translateY(-1px);
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
  }

  header .project-inputs {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  header .project-inputs .icon-btn {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 12px;
    border-radius: 10px;
    backdrop-filter: blur(10px);
    transition: all 0.2s ease;
    font-size: 16px;
    font-weight: bold;
  }

  header .project-inputs .icon-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  header .actions {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  /* Position left actions in first grid column */
  header .actions:first-child {
    grid-column: 1;
    justify-self: start;
  }

  /* Position right actions in third grid column */
  header .actions:last-child {
    grid-column: 3;
    justify-self: end;
  }

  header .actions .status-msg {
    color: white;
    font-weight: 500;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    backdrop-filter: blur(5px);
  }

  /* Hide status message when empty */
  header .actions .status-msg:empty {
    display: none;
  }

  header .actions #project-name-indicator {
    color: white;
    font-weight: 600;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    backdrop-filter: blur(10px);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  .project-header-container {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .project-name-text {
    color: white;
    font-weight: 600;
    font-size: 14px;
  }

  .project-settings-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
  }

  .project-settings-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.5);
    transform: translateY(-1px);
  }

  .project-settings-btn:active {
    transform: translateY(0);
  }

  /* Global Settings Dropdown */
  .global-settings-container {
    position: relative;
    margin-left: 12px;
  }

  .global-settings-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
    color: white;
  }

  .global-settings-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.4);
    transform: translateY(-1px);
  }

  .global-settings-btn:active {
    transform: translateY(0);
  }

  .global-settings-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    min-width: 200px;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 12px;
    box-shadow: var(--shadow-xl);
    padding: 16px;
    z-index: 1000;
    transition: all 0.2s ease;
  }

  .global-settings-dropdown.is-hidden {
    opacity: 0;
    transform: translateY(-8px);
    pointer-events: none;
  }

  .settings-section {
    margin-bottom: 16px;
  }

  .settings-section:last-child {
    margin-bottom: 0;
  }

  .settings-section label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .theme-options {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .theme-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    color: var(--fg);
    transition: all 0.2s ease;
    width: 100%;
    text-align: left;
  }

  .theme-option:hover {
    background: var(--surface-3);
    border-color: var(--accent);
  }

  .theme-option.active {
    background: var(--accent-weak);
    border-color: var(--accent);
    color: var(--accent);
  }

  .theme-preview {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 1px solid var(--line);
  }

  .light-preview {
    background: linear-gradient(45deg, #ffffff 50%, #f8faff 50%);
  }

  .dark-preview {
    background: linear-gradient(45deg, #0a0f24 50%, #151f41 50%);
  }

  .gold-preview {
    background: linear-gradient(45deg, #f2b800 50%, #f4e412 50%);
  }

  .settings-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    color: var(--fg);
    transition: all 0.2s ease;
    width: 100%;
    text-align: left;
    margin-bottom: 4px;
  }

  .settings-item:last-child {
    margin-bottom: 0;
  }

  .settings-item:hover {
    background: var(--surface-3);
    border-color: var(--accent);
  }

  /* Hamburger Navigation */
  .hamburger-nav-container {
    position: relative;
    margin-right: 12px;
  }

  .hamburger-nav-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
  }

  .hamburger-nav-btn:hover {
    background: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.4);
    transform: translateY(-1px);
  }

  .hamburger-nav-btn:active {
    transform: translateY(0);
  }

  .hamburger-icon {
    display: flex;
    flex-direction: column;
    gap: 3px;
    width: 16px;
  }

  .hamburger-icon span {
    display: block;
    height: 2px;
    width: 100%;
    background: white;
    border-radius: 1px;
    transition: all 0.3s ease;
  }

  .hamburger-nav-btn.active .hamburger-icon span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .hamburger-nav-btn.active .hamburger-icon span:nth-child(2) {
    opacity: 0;
  }

  .hamburger-nav-btn.active .hamburger-icon span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -6px);
  }

  .hamburger-nav-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    min-width: 200px;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 12px;
    box-shadow: var(--shadow-xl);
    padding: 12px;
    z-index: 1000;
    transition: all 0.2s ease;
  }

  .hamburger-nav-dropdown.is-hidden {
    opacity: 0;
    transform: translateY(-8px);
    pointer-events: none;
  }

  .nav-section {
    margin-bottom: 12px;
  }

  .nav-section:last-child {
    margin-bottom: 0;
  }

  .nav-section.coming-soon {
    border-top: 1px solid var(--line);
    padding-top: 12px;
    margin-top: 12px;
  }

  .nav-section-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--fg);
    text-decoration: none;
    transition: all 0.2s ease;
    margin-bottom: 6px;
  }

  .nav-item:last-child {
    margin-bottom: 0;
  }

  .nav-item:hover:not(.disabled) {
    background: var(--surface-3);
    border-color: var(--accent);
    transform: translateY(-1px);
  }

  .nav-item.active {
    background: var(--accent-weak);
    border-color: var(--accent);
    color: var(--accent);
  }

  .nav-item.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .nav-item.disabled:hover {
    transform: none;
    border-color: var(--line);
    background: var(--surface-2);
  }

  .nav-icon {
    font-size: 16px;
    width: 20px;
    text-align: center;
  }

  .nav-label {
    flex: 1;
  }

  .project-selector-dropdown {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: white;
    padding: 8px 16px;
    font-weight: 600;
    backdrop-filter: blur(10px);
    max-width: 250px;
    min-width: 200px;
  }

  .project-selector-dropdown option {
    background: var(--brand-primary);
    color: white;
  }

  .project-indicator {
    max-width: 250px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* --- Main Navigation (Legacy, centered pill buttons) --- */
  nav.app-nav {
    position: sticky;
    top: 0;
    z-index: 50;
    background: var(--surface-2);
    border-bottom: 1px solid var(--line);
    padding: 12px 0;
  }
  .app-nav .nav-inner {
    width: 100%;
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  .nav-btn {
    padding: 8px 14px;
    border: 1px solid var(--line);
    border-radius: 999px;
    background: var(--surface-1);
    color: var(--muted);
    font-weight: 600;
    transition: box-shadow .15s, transform .05s;
  }
  .nav-btn:hover {
    transform: translateY(-1px);
  }
  .nav-btn.active {
    color: var(--fg);
    box-shadow: 0 0 0 2px var(--ring);
  }

  /* --- Project Shell Navigation (Modern Card Design) --- */
  .project-shell-nav {
    position: sticky;
    top: 0;
    z-index: 50;
    background: transparent;
    padding: 8px 16px 16px 16px;
    overflow: visible;
    min-height: fit-content;
    box-sizing: border-box;
    transition: transform 0.3s ease, opacity 0.3s ease;
    transform: translateY(0);
    opacity: 1;
  }

  .project-shell-nav.nav-hidden {
    transform: translateY(-100%);
    opacity: 0;
    pointer-events: none;
  }
  .project-shell-nav-inner {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    gap: 12px;
    align-items: center;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-xl);
    padding: 8px;
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: visible;
  }
  .shell-tab {
    padding: 12px 16px;
    border: none;
    border-radius: var(--radius-md);
    background: transparent;
    color: var(--muted);
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 40px;
    font-family: 'Aptos', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  }
  .shell-tab:hover {
    background: var(--surface-2);
    color: var(--fg);
    transform: translateY(-1px);
  }
  .shell-tab.active {
    background: var(--accent);
    color: white;
    box-shadow: var(--shadow-sm);
  }
  .shell-tab.active:hover {
    background: var(--accent-weak);
    transform: translateY(-1px);
  }

  /* === MODERN NAVIGATION PANEL === */
  /* Super Thin Sticky Top Bar */
  .project-top-bar {
    position: sticky;
    top: 0;
    z-index: 100;
    background: white;
    border-bottom: 2px solid #e5e7eb;
    padding: 8px 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    height: 48px;
    min-height: 48px;
    margin: 0;
  }

  .hamburger-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--brand-secondary);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    color: var(--brand-primary);
    flex-shrink: 0;
  }

  .hamburger-btn:hover {
    background: var(--brand-primary);
    color: var(--brand-secondary);
    transform: scale(1.05);
    box-shadow: 0 2px 8px rgba(33, 33, 97, 0.15);
  }

  .project-breadcrumb {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1;
    font-size: 14px;
    min-width: 0;
  }

  .project-name {
    font-size: 14px;
    font-weight: 700;
    color: var(--brand-primary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .breadcrumb-separator {
    color: var(--muted);
    font-size: 14px;
    flex-shrink: 0;
  }

  .active-section {
    font-size: 13px;
    color: var(--muted);
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .close-project-btn {
    background: white;
    color: var(--brand-primary);
    border: 2px solid var(--brand-primary);
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .close-project-btn:hover {
    background: var(--brand-primary);
    color: white;
    border-color: var(--brand-primary);
    box-shadow: 0 2px 6px rgba(33, 33, 97, 0.2);
  }

  /* Navigation Panel Overlay - Glassmorphism */
  .nav-panel-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.3);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease, backdrop-filter 0.3s ease;
  }

  .nav-panel-overlay.visible {
    opacity: 1;
    visibility: visible;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  /* Slide-Out Navigation Panel */
  .nav-panel {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 320px;
    background: var(--brand-primary);
    z-index: 1000;
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2);
  }

  .nav-panel.open {
    transform: translateX(0);
  }

  /* Navigation Panel Header */
  .nav-panel-header {
    padding: 24px;
    background: linear-gradient(135deg, #FFE47A 0%, #F2B800 100%);
    border-bottom: 3px solid var(--brand-primary);
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .nav-panel-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 700;
    color: var(--brand-primary);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .nav-close-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 2px solid var(--brand-primary);
    border-radius: 6px;
    color: var(--brand-primary);
    font-size: 24px;
    line-height: 1;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .nav-close-btn:hover {
    background: var(--brand-primary);
    color: white;
    transform: rotate(90deg);
  }

  /* Navigation Panel Body */
  .nav-panel-body {
    flex: 1;
    overflow-y: auto;
    padding: 16px 0;
  }

  .nav-section {
    padding: 8px 16px;
  }

  .nav-section-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--brand-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
    padding: 0 8px;
  }

  /* Navigation Items */
  .nav-panel-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 16px;
    background: transparent;
    border: none;
    border-left: 4px solid transparent;
    color: white;
    font-size: 15px;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    border-radius: 0 8px 8px 0;
    margin-bottom: 2px;
  }

  .nav-panel-item:hover {
    background: rgba(255, 255, 255, 0.1);
    border-left-color: var(--brand-secondary);
  }

  .nav-panel-item.active {
    background: linear-gradient(90deg, rgba(255, 228, 122, 0.15) 0%, rgba(242, 184, 0, 0.1) 100%);
    border-left-color: var(--brand-secondary);
    font-weight: 700;
  }

  .nav-item-icon {
    font-size: 20px;
    width: 24px;
    text-align: center;
  }

  .nav-item-label {
    flex: 1;
  }

  .nav-item-indicator {
    width: 8px;
    height: 8px;
    background: var(--brand-secondary);
    border-radius: 50%;
    box-shadow: 0 0 8px var(--brand-secondary);
  }

  /* Navigation Divider */
  .nav-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.15);
    margin: 16px 24px;
  }

  /* Project Info Section */
  .nav-project-info {
    padding: 20px 24px;
    background: rgba(0, 0, 0, 0.2);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    margin-top: auto;
  }

  .nav-info-label {
    font-size: 11px;
    font-weight: 600;
    color: var(--brand-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
  }

  .nav-info-value {
    font-size: 14px;
    color: white;
    font-weight: 500;
  }

  .nav-info-value.status-draft {
    color: #9ca3af;
  }

  .nav-info-value.status-fielding {
    color: #10b981;
  }

  .nav-info-value.status-reporting {
    color: #f59e0b;
  }

  .nav-info-value.status-closed {
    color: #ef4444;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .nav-panel {
      width: 280px;
    }

    .project-breadcrumb {
      display: none;
    }
  }

  /* --- Sidebar / Drawer --- */
  .side-drawer {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1000;
  }
  .side-drawer .sd-panel {
    position: absolute;
    transform: none !important;
    width: 280px;
    max-height: min(70vh, 560px);
    overflow: auto;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 14px;
    box-shadow: var(--shadow);
    pointer-events: auto;
    display: none;
    padding: 10px;
  }
  body.sidebar-open .side-drawer .sd-panel {
    display: block;
  }
  .sidebar-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.2);
    backdrop-filter: blur(2px);
    z-index: 99;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease-out;
  }
  body.sidebar-open .sidebar-backdrop {
    opacity: 1;
    pointer-events: auto;
  }
  .sd-title {
    margin: 8px 8px 4px;
    font-weight: 600;
    color: var(--muted);
    font-size: 12px;
    text-transform: uppercase;
  }
  .sd-link {
    display: flex;
    align-items: center;
    padding: 12px 14px;
    margin: 2px 0;
    border-radius: 10px;
    width: 100%;
    text-align: left;
  }
  .sd-link:hover {
    background: rgba(33, 33, 97, .06);
  }
  .sd-link.active {
    background: rgba(33, 33, 97, .10);
    color: var(--brand-primary);
    font-weight: 600;
  }
  .sd-link .icon {
    margin-right: 8px;
    flex-shrink: 0;
  }
  .sd-panel hr {
    border: 0;
    border-top: 1px solid var(--line);
    margin: 8px 0;
  }
  @media (max-width: 900px) {
    .side-drawer .sd-panel { width: 80vw; }
  }


  /* ===================================================================
    7. CORE COMPONENTS
    - Cards, Modals, Pills, Menus, etc.
    =================================================================== */

  /* --- Cards --- */
  .card {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    transition: all 0.3s ease, transform 0.2s ease;
  }

  .card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }
  .card-header {
    padding: 10px 14px;
    border-bottom: 1px solid var(--line);
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
  }
  .card-content {
    padding: 14px;
  }

  /* --- Modals --- */
  .modal {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: grid;
    place-items: center;
  }
  .modal-panel {
    width: min(720px, 92vw);
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 16px;
    box-shadow: var(--shadow-xl);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    max-height: 85vh;
    animation: modalIn .18s ease-out;
  }
  @keyframes modalIn {
    from { opacity: 0; transform: translateY(-16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .modal-header {
    padding: 16px 20px;
    background: var(--surface-2);
    border-bottom: 1px solid var(--line);
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .modal-header h3 {
    margin: 0;
    flex: 1;
    text-align: center;
    font-size: 18px;
    font-weight: 600;
  }

  .modal-close-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    color: var(--fg);
    transition: all 0.2s ease;
  }

  .modal-close-btn:hover {
    background: var(--surface-3);
    border-color: var(--danger);
    color: var(--danger);
  }

  .close-icon {
    font-size: 16px;
    font-weight: bold;
  }

  .close-text {
    font-weight: 500;
  }
  .modal-body {
    padding: 16px 20px;
    display: grid;
    gap: 12px;
    overflow-y: auto;
  }
  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 12px 20px 16px;
    background: var(--surface-2);
    border-top: 1px solid var(--line);
    flex-shrink: 0;
  }
  .modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, .35);
    backdrop-filter: blur(2px);
    z-index: -1;
  }

  /* --- Medication Group Setup Styles --- */
  .medication-groups-setup .preset-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
  }

  .medication-groups-setup .preset-options label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: background-color 0.2s;
  }

  .medication-groups-setup .preset-options label:hover {
    background: var(--surface-3);
  }

  .medication-groups-setup .group-preset h4 {
    margin: 0 0 4px 0;
    color: var(--accent);
    font-size: 14px;
  }

  /* Option visual indicators */
  .option-row[data-medication-group] {
    position: relative;
  }

  .option-row[data-medication-group]::before {
    content: '';
    position: absolute;
    left: -16px;
    top: 12px;
    width: 8px;
    height: 8px;
    background: var(--accent);
    border-radius: 50%;
    border: 2px solid var(--surface-1);
  }

  .option-row[data-preferred-name="true"] {
    background: rgba(var(--accent-rgb), 0.05);
    border-left: 3px solid var(--accent);
    padding-left: 8px;
  }

  /* Subtle anchored option indicators */
  .option-row[data-anchor="top"] {
    position: relative;
  }

  .option-row[data-anchor="top"]::before {
    content: '';
    position: absolute;
    bottom: -4px;
    left: -4px;
    width: 96px;
    height: 48px;
    border-bottom: 2px solid var(--accent);
    border-left: 2px solid var(--accent);
  }

  .option-row[data-anchor="bottom"] {
    position: relative;
  }

  .option-row[data-anchor="bottom"]::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    width: 96px;
    height: 48px;
    border-top: 2px solid var(--accent);
    border-left: 2px solid var(--accent);
  }

  /* Table features */
  .table-preview-container {
    background: var(--surface-2);
    border-radius: var(--radius-md);
    padding: 12px;
  }

  .table-preview table {
    background: var(--surface-1);
    border-radius: 6px;
  }

  .table-preview th {
    background: var(--surface-2);
    font-size: 12px;
    color: var(--muted);
  }

  .table-preview td {
    background: var(--surface-1);
  }

  .bulk-actions {
    display: flex;
    gap: 8px;
  }

  .bulk-actions .btn {
    padding: 6px 12px;
    font-size: 12px;
  }

  .sum-validation-panel {
    transition: all 0.2s ease;
  }

  /* Enhanced drag handles for tables */
  .option-editor-row[draggable="true"] .drag-handle {
    cursor: grab;
    color: var(--muted);
    font-size: 14px;
    padding: 8px 4px;
    transition: color 0.2s ease;
  }

  .option-editor-row[draggable="true"] .drag-handle:hover {
    color: var(--accent);
  }

  .option-editor-row[draggable="true"]:hover {
    background: var(--surface-2);
    border-radius: 4px;
  }

  /* Validation Panel Styles */
  .validation-panel {
    background: var(--surface-1);
    border-radius: var(--radius-lg);
    padding: 24px;
    max-width: 800px;
    margin: 0 auto;
  }

  .validation-header {
    margin-bottom: 32px;
  }

  .export-status {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    border-radius: var(--radius-md);
    margin-bottom: 20px;
  }

  .export-status.ready {
    background: #f0fdf4;
    border: 1px solid #16a34a;
  }

  .export-status.not-ready {
    background: #fef2f2;
    border: 1px solid #dc2626;
  }

  .status-icon {
    font-size: 32px;
  }

  .status-content h3 {
    margin: 0 0 4px 0;
    font-size: 18px;
    font-weight: 600;
  }

  .status-content p {
    margin: 0;
    color: var(--muted);
    font-size: 14px;
  }

  .validation-summary {
    display: flex;
    gap: 24px;
    justify-content: center;
  }

  .summary-item {
    text-align: center;
  }

  .summary-item .count {
    display: block;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .summary-item .label {
    font-size: 12px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .error-count {
    color: var(--danger);
  }

  .warning-count {
    color: #f59e0b;
  }

  .info-count {
    color: var(--accent);
  }

  .no-issues {
    text-align: center;
    padding: 48px 24px;
  }

  .success-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }

  .no-issues h4 {
    margin: 0 0 8px 0;
    font-size: 20px;
    color: var(--fg);
  }

  .no-issues p {
    margin: 0;
    color: var(--muted);
  }

  .issue-group {
    margin-bottom: 32px;
  }

  .group-header {
    margin: 0 0 8px 0;
    font-size: 16px;
    font-weight: 600;
  }

  .error-header {
    color: var(--danger);
  }

  .warning-header {
    color: #f59e0b;
  }

  .info-header {
    color: var(--accent);
  }

  .group-description {
    margin: 0 0 16px 0;
    font-size: 14px;
    color: var(--muted);
  }

  .issue-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    margin-bottom: 8px;
    border-left: 4px solid;
  }

  .error-item {
    background: #fef2f2;
    border-left-color: var(--danger);
  }

  .warning-item {
    background: #fffbeb;
    border-left-color: #f59e0b;
  }

  .info-item {
    background: var(--surface-2);
    border-left-color: var(--accent);
  }

  .issue-content {
    flex: 1;
  }

  .issue-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
  }

  .issue-icon {
    font-size: 14px;
  }

  .issue-question {
    font-weight: 600;
    font-size: 13px;
    color: var(--accent);
  }

  .issue-message {
    font-size: 14px;
    color: var(--fg);
  }

  .issue-action-btn {
    padding: 6px 12px;
    font-size: 12px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .issue-action-btn:hover {
    background: var(--accent-weak);
  }

  .validation-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 32px;
    padding-top: 24px;
    border-top: 1px solid var(--line);
  }

  /* Compact Validation Status */
  .validation-status-compact {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: var(--surface-2);
    border-radius: var(--radius-sm);
    font-size: 13px;
  }

  .status-indicator {
    font-size: 16px;
  }

  .status-ready {
    color: #16a34a;
  }

  .status-blocked {
    color: var(--danger);
  }

  /* Field Validation */
  .field-validation {
    margin-top: 4px;
  }

  .validation-message {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 8px;
    border-radius: var(--radius-sm);
    font-size: 12px;
  }

  .validation-error .validation-message {
    background: #fef2f2;
    color: var(--danger);
  }

  .validation-warning .validation-message {
    background: #fffbeb;
    color: #f59e0b;
  }

  .validation-info .validation-message {
    background: var(--surface-2);
    color: var(--accent);
  }

  .validation-icon {
    font-size: 12px;
  }

  /* Validation View Page Styles */
  .validation-view {
    width: 100%;
    padding: 24px;
  }

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--line);
  }

  .page-title-section {
    flex: 1;
  }

  .page-title {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 0 0 8px 0;
    font-size: 28px;
    font-weight: 700;
    color: var(--fg);
  }

  .page-icon {
    font-size: 24px;
  }

  .page-description {
    margin: 0;
    font-size: 16px;
    color: var(--muted);
    line-height: 1.5;
  }

  .page-actions {
    display: flex;
    gap: 12px;
  }

  .project-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 32px;
  }

  .summary-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    transition: all 0.2s ease;
  }

  .summary-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
  }

  .summary-icon {
    font-size: 24px;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--surface-2);
    border-radius: var(--radius-md);
  }

  .summary-content {
    flex: 1;
  }

  .summary-number {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 4px;
  }

  .summary-label {
    font-size: 14px;
    color: var(--muted);
    font-weight: 500;
  }

  .validation-results-container {
    margin-bottom: 32px;
  }

  .validation-quick-actions {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    padding: 24px;
  }

  /* Enhanced Validation Controls */
  .validation-controls {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    padding: 20px;
    margin-bottom: 20px;
  }

  .controls-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    margin-bottom: 16px;
  }

  .filter-controls {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .search-controls {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .filter-select {
    padding: 8px 12px;
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    background: var(--surface-2);
    color: var(--fg);
    font-size: 14px;
    min-width: 140px;
  }

  .search-input {
    padding: 8px 12px;
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    background: var(--surface-2);
    color: var(--fg);
    font-size: 14px;
    min-width: 200px;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 2px var(--ring);
  }

  .bulk-actions {
    display: flex;
    gap: 8px;
    padding-top: 16px;
    border-top: 1px solid var(--line);
  }

  .bulk-actions .btn {
    font-size: 13px;
    padding: 6px 12px;
  }

  /* Issue Group Expansion */
  .issue-group {
    margin-bottom: 16px;
  }

  .issue-group .group-header {
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 0;
    user-select: none;
  }

  .issue-group .group-header::before {
    content: '▶';
    transition: transform 0.2s ease;
    font-size: 12px;
  }

  .issue-group.expanded .group-header::before {
    transform: rotate(90deg);
  }

  .issue-group .issues-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .issue-group.expanded .issues-content {
    max-height: 1000px;
  }

  /* Responsive design for validation controls */
  @media (max-width: 768px) {
    .controls-row {
      flex-direction: column;
      align-items: stretch;
      gap: 16px;
    }

    .filter-controls,
    .search-controls {
      flex-wrap: wrap;
    }

    .bulk-actions {
      flex-wrap: wrap;
    }
  }

  /* ===================================================================
   QUESTION LIBRARY SYSTEM STYLES
   =================================================================== */

  /* Library View Layout */
  .library-view {
    width: 100%;
    padding: 24px;
    background: var(--bg);
    min-height: 100vh;
  }

  /* Library Header */
  .library-header {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: var(--shadow);
  }

  .header-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
  }

  .header-title h1 {
    margin: 0 0 8px 0;
    font-size: 28px;
    font-weight: 700;
    color: var(--fg);
  }

  .header-title p {
    margin: 0;
    color: var(--muted);
    font-size: 16px;
  }

  .header-actions {
    display: flex;
    gap: 12px;
  }

  /* Library Stats */
  .library-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
  }

  .stat-card {
    text-align: center;
    padding: 16px;
    background: var(--surface-2);
    border-radius: var(--radius-md);
    border: 1px solid var(--line);
  }

  .stat-number {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 4px;
  }

  .stat-label {
    font-size: 13px;
    color: var(--muted);
    font-weight: 500;
  }

  /* Library Controls */
  .library-controls {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    padding: 20px;
    margin-bottom: 24px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .search-section {
    display: flex;
    justify-content: center;
  }

  .search-box {
    position: relative;
    max-width: 500px;
    width: 100%;
  }

  .search-input {
    width: 100%;
    padding: 12px 16px 12px 45px;
    border: 2px solid var(--line);
    border-radius: var(--radius-md);
    background: var(--surface-2);
    color: var(--fg);
    font-size: 16px;
    transition: all 0.2s ease;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--ring);
  }

  .search-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    font-size: 16px;
  }

  .filter-section {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .filter-select {
    padding: 8px 12px;
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    background: var(--surface-2);
    color: var(--fg);
    font-size: 14px;
    min-width: 150px;
  }

  .view-controls {
    display: flex;
    justify-content: center;
    gap: 4px;
  }

  .view-toggle {
    padding: 8px 16px;
    border: 1px solid var(--line);
    background: var(--surface-2);
    color: var(--muted);
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .view-toggle:first-child {
    border-radius: var(--radius-md) 0 0 var(--radius-md);
  }

  .view-toggle:last-child {
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
    border-left: none;
  }

  .view-toggle.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  /* Library Content Layout */
  .library-content {
    display: grid;
    grid-template-columns: 1fr 280px;
    gap: 24px;
  }

  /* Question Cards Grid View */
  .library-questions[data-view-mode="grid"] {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
  }

  .question-card {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .question-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
    border-color: var(--accent);
  }

  .question-card.highlighted {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--ring);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 16px 0 16px;
  }

  .question-category {
    font-size: 12px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .question-actions {
    display: flex;
    gap: 4px;
  }

  .action-icon {
    padding: 4px;
    border: none;
    background: none;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.2s ease;
  }

  .action-icon:hover {
    background: var(--surface-3);
  }

  .card-content {
    padding: 16px;
  }

  .question-title {
    margin: 0 0 8px 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--fg);
    line-height: 1.3;
  }

  .question-text {
    margin: 0 0 12px 0;
    font-size: 14px;
    color: var(--muted);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .question-meta {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 12px;
  }

  .meta-item {
    font-size: 12px;
    color: var(--muted);
    background: var(--surface-3);
    padding: 4px 8px;
    border-radius: 4px;
  }

  .question-tags {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .tag {
    font-size: 11px;
    background: var(--accent);
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: 500;
  }

  .tag-more {
    font-size: 11px;
    background: var(--muted);
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
  }

  .card-footer {
    padding: 16px;
    border-top: 1px solid var(--line);
    background: var(--surface-2);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .question-stats {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .stat {
    font-size: 12px;
    color: var(--muted);
  }

  /* Question List View */
  .library-questions[data-view-mode="list"] {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .question-row {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.2s ease;
  }

  .question-row:hover {
    border-color: var(--accent);
    box-shadow: var(--shadow);
  }

  .question-row.highlighted {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px var(--ring);
  }

  .row-content {
    flex: 1;
    min-width: 0;
  }

  .row-main .question-title {
    margin-bottom: 4px;
    font-size: 15px;
  }

  .row-main .question-text {
    font-size: 13px;
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .row-meta {
    display: flex;
    gap: 16px;
    margin-top: 8px;
  }

  .row-meta .meta-item {
    background: none;
    padding: 0;
    font-size: 12px;
  }

  .row-actions {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-shrink: 0;
  }

  /* Library Sidebar */
  .library-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .sidebar-section {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    padding: 20px;
  }

  .sidebar-section h3 {
    margin: 0 0 16px 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--fg);
  }

  .quick-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .action-btn {
    padding: 10px 12px;
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    background: var(--surface-2);
    color: var(--fg);
    cursor: pointer;
    text-align: left;
    font-size: 13px;
    transition: all 0.2s ease;
  }

  .action-btn:hover {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .category-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .category-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .category-item:hover {
    background: var(--surface-3);
  }

  .category-name {
    font-size: 13px;
    color: var(--fg);
  }

  .category-count {
    font-size: 12px;
    color: var(--muted);
    background: var(--surface-3);
    padding: 2px 6px;
    border-radius: 3px;
  }

  .recent-questions {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .recent-item {
    padding: 10px 12px;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: background 0.2s ease;
    border: 1px solid transparent;
  }

  .recent-item:hover {
    background: var(--surface-3);
    border-color: var(--line);
  }

  .recent-title {
    font-size: 13px;
    color: var(--fg);
    font-weight: 500;
    margin-bottom: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .recent-meta {
    font-size: 11px;
    color: var(--muted);
  }

  /* No Questions State */
  .no-questions {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }

  .no-questions-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }

  .no-questions h3 {
    margin: 0 0 8px 0;
    color: var(--fg);
  }

  .no-questions p {
    margin: 0;
    font-size: 14px;
  }

  /* Save Question Modal - Uses existing modal styles */

  /* Button Size Variants */
  .btn.small {
    padding: 6px 12px;
    font-size: 13px;
  }

  /* Responsive Design for Library */
  @media (max-width: 1024px) {
    .library-content {
      grid-template-columns: 1fr;
    }

    .library-sidebar {
      order: -1;
    }

    .sidebar-section {
      padding: 16px;
    }

    .library-questions[data-view-mode="grid"] {
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
  }

  @media (max-width: 768px) {
    .library-view {
      padding: 16px;
    }

    .header-content {
      flex-direction: column;
      gap: 16px;
      align-items: stretch;
    }

    .header-actions {
      justify-content: flex-end;
    }

    .library-stats {
      grid-template-columns: repeat(2, 1fr);
    }

    .filter-section {
      flex-direction: column;
      align-items: stretch;
    }

    .filter-select {
      min-width: unset;
    }

    .library-questions[data-view-mode="grid"] {
      grid-template-columns: 1fr;
    }

    .question-row {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
    }

    .row-actions {
      justify-content: flex-end;
    }

    .form-row {
      grid-template-columns: 1fr;
    }

    .modal {
      width: 95%;
      margin: 20px;
    }
  }

  .quick-actions-header {
    margin-bottom: 24px;
  }

  .quick-actions-header h3 {
    margin: 0 0 8px 0;
    font-size: 20px;
    font-weight: 600;
    color: var(--fg);
  }

  .quick-actions-header p {
    margin: 0;
    color: var(--muted);
    font-size: 14px;
  }

  .quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
  }

  .quick-action-card {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 16px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .quick-action-card:hover {
    background: var(--surface-3);
    transform: translateY(-1px);
  }

  .action-icon {
    font-size: 20px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent);
    color: white;
    border-radius: var(--radius-sm);
    flex-shrink: 0;
  }

  .action-content {
    flex: 1;
  }

  .action-content h4 {
    margin: 0 0 6px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--fg);
  }

  .action-content p {
    margin: 0;
    font-size: 12px;
    color: var(--muted);
    line-height: 1.4;
  }

  /* Shell Navigation More Dropdown Styles */
  .project-shell-nav .more-dropdown {
    position: relative;
    display: inline-block;
    margin-left: auto;
    margin-right: 12px;
  }

  .project-shell-nav .more-btn {
    position: relative;
  }

  .project-shell-nav .more-menu {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    min-width: 200px;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow);
    z-index: 999;
    overflow: hidden;
    padding: 8px;
    pointer-events: auto;
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .project-shell-nav .more-menu.is-hidden {
    display: none;
  }

  .project-shell-nav .more-menu-item {
    display: block;
    padding: 12px 16px;
    color: var(--fg);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    border-radius: var(--radius-md);
    transition: all 0.2s ease;
    margin-bottom: 4px;
    font-family: 'Aptos', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  }

  .project-shell-nav .more-menu-item:last-child {
    margin-bottom: 0;
  }

  .project-shell-nav .more-menu-item:hover {
    background: var(--surface-2);
    transform: translateY(-1px);
  }

  .project-shell-nav .more-menu-item.active {
    background: var(--accent);
    color: white;
    box-shadow: var(--shadow-sm);
  }

  /* Question List Validation Indicators */
  .question-item.has-validation-issues {
    border-left: 3px solid var(--danger);
    background: #fef2f2;
  }

  .question-item.has-validation-issues .tag {
    background: var(--danger);
    color: white;
  }

  .question-item.has-validation-issues::after {
    content: '⚠️';
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 12px;
  }

  /* Randomization status indicator */
  .randomization-status {
    font-weight: 500;
    transition: all 0.2s;
    position: relative;
  }

  .randomization-status:hover {
    background: var(--surface-2) !important;
    transform: translateY(-1px);
  }

  .randomization-status.randomized {
    color: var(--accent);
    border-color: var(--accent) !important;
  }

  .randomization-status.sequential {
    color: var(--muted);
  }

  .randomization-status::after {
    content: attr(title);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface-1);
    border: 1px solid var(--line);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    z-index: 100;
  }

  .randomization-status:hover::after {
    opacity: 1;
  }

  /* Enhanced Option Behavior Panel */
  .option-behavior-panel {
    margin-bottom: 24px;
    padding: 20px;
    background: linear-gradient(135deg, var(--surface-1) 0%, var(--surface-2) 100%);
    border: 1px solid var(--line);
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  }

  .behavior-title {
    margin: 0 0 16px 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .behavior-title::before {
    content: '';
    width: 16px;
    height: 16px;
    background: var(--accent);
    border-radius: 3px;
    display: inline-block;
    margin-right: 2px;
  }

  .behavior-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  .behavior-item {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .behavior-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 0;
  }

  /* Selection Controls */
  .selection-controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .selection-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border: 2px solid var(--line);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--surface-1);
  }

  .selection-option:hover {
    border-color: var(--accent);
    background: var(--surface-2);
    transform: translateY(-1px);
  }

  .selection-option.active {
    border-color: var(--accent);
    background: rgba(var(--accent-rgb), 0.1);
    box-shadow: 0 0 0 3px rgba(var(--accent-rgb), 0.1);
  }

  .selection-option input {
    display: none;
  }

  .selection-icon {
    width: 20px;
    height: 20px;
    border: 2px solid var(--line);
    border-radius: 50%;
    position: relative;
    flex-shrink: 0;
  }

  .single-icon {
    border-radius: 50%;
  }

  .multi-icon {
    border-radius: 4px;
  }

  .selection-option.active .single-icon::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 8px;
    height: 8px;
    background: var(--accent);
    border-radius: 50%;
  }

  .selection-option.active .multi-icon::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--accent);
    font-size: 12px;
    font-weight: bold;
  }

  .selection-option.active .selection-icon {
    border-color: var(--accent);
  }

  .selection-option span:last-child {
    font-weight: 500;
    font-size: 14px;
  }

  /* Randomization Controls */
  .randomization-controls {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .randomization-status-display {
    display: flex;
    justify-content: center;
  }

  .randomization-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 20px;
    border: 2px solid var(--line);
    background: var(--surface-1);
    cursor: default;
    transition: all 0.3s;
    font-weight: 500;
    font-size: 13px;
  }

  .randomization-badge:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .randomization-badge.randomized {
    border-color: var(--accent);
    background: linear-gradient(135deg, rgba(var(--accent-rgb), 0.1) 0%, rgba(var(--accent-rgb), 0.05) 100%);
    color: var(--accent);
  }

  .randomization-badge.sequential {
    border-color: var(--muted);
    color: var(--muted);
  }

  .badge-icon {
    width: 16px;
    height: 16px;
    position: relative;
    flex-shrink: 0;
  }

  .shuffle-icon::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 0;
    width: 16px;
    height: 2px;
    background: currentColor;
    border-radius: 1px;
  }

  .shuffle-icon::after {
    content: '';
    position: absolute;
    bottom: 2px;
    left: 0;
    width: 16px;
    height: 2px;
    background: currentColor;
    border-radius: 1px;
    opacity: 0.6;
  }

  .order-icon::before {
    content: '';
    position: absolute;
    top: 1px;
    left: 0;
    width: 16px;
    height: 2px;
    background: currentColor;
    border-radius: 1px;
    box-shadow: 0 4px 0 currentColor, 0 8px 0 currentColor, 0 12px 0 currentColor;
  }

  .badge-text {
    font-weight: 600;
  }

  .randomization-toggle {
    display: flex;
    gap: 8px;
    background: var(--surface-2);
    padding: 4px;
    border-radius: 8px;
  }

  .toggle-option {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 13px;
    font-weight: 500;
    color: var(--muted);
  }

  .toggle-option:hover {
    background: var(--surface-3);
    color: var(--text);
  }

  .toggle-option.active {
    background: var(--surface-1);
    color: var(--accent);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .toggle-option input {
    display: none;
  }

  @media (max-width: 768px) {
    .behavior-grid {
      grid-template-columns: 1fr;
      gap: 16px;
    }
  }

  /* Enhanced Section Headers */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }

  .section-badge {
    width: 24px;
    height: 24px;
    background: var(--surface-2);
    border-radius: 6px;
    border: 1px solid var(--line);
    position: relative;
    flex-shrink: 0;
  }

  .logic-badge::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 3px;
    transform: translateY(-50%);
    width: 6px;
    height: 6px;
    background: var(--accent);
    border-radius: 50%;
    box-shadow: 6px 0 0 var(--accent), 12px 0 0 var(--accent);
  }

  .logic-badge::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 6px;
    transform: translateY(-50%);
    width: 12px;
    height: 1px;
    background: var(--accent);
  }

  .settings-badge::before {
    content: '';
    position: absolute;
    top: 4px;
    left: 4px;
    width: 16px;
    height: 2px;
    background: var(--muted);
    border-radius: 1px;
    box-shadow: 0 4px 0 var(--muted), 0 8px 0 var(--muted), 0 12px 0 var(--muted);
  }

  .settings-badge::after {
    content: '';
    position: absolute;
    top: 5px;
    right: 4px;
    width: 6px;
    height: 6px;
    border: 1px solid var(--muted);
    border-radius: 50%;
  }

  .section-description {
    color: var(--muted);
    font-size: 13px;
    margin-bottom: 20px;
    font-style: italic;
  }

  /* Logic & Flow Section */
  .logic-flow-section {
    border-left: 3px solid var(--accent);
    padding-left: 16px;
    background: linear-gradient(90deg, rgba(var(--accent-rgb), 0.02) 0%, transparent 100%);
  }

  .logic-container {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 8px;
    padding: 16px;
  }

  /* Settings Section */
  .settings-section {
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 20px;
  }

  .settings-panel {
    background: var(--surface-2);
    border-radius: 8px;
    padding: 16px;
  }

  .enhanced-form-row {
    margin-bottom: 0;
  }

  .enhanced-label {
    display: flex;
    flex-direction: column;
    gap: 4px;
    margin-bottom: 8px;
  }

  .label-text {
    font-weight: 600;
    color: var(--text);
    font-size: 14px;
  }

  .label-hint {
    font-size: 12px;
    color: var(--muted);
    font-weight: 400;
  }

  .enhanced-input {
    border: 2px solid var(--line);
    border-radius: 8px;
    padding: 12px;
    transition: all 0.2s;
    background: var(--surface-1);
  }

  .enhanced-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(var(--accent-rgb), 0.1);
    background: var(--surface-1);
  }

  .enhanced-input::placeholder {
    color: var(--muted);
    font-style: italic;
  }

  /* Professional Condition Icons */
  .condition-icon {
    width: 14px;
    height: 14px;
    position: relative;
    display: inline-block;
    margin-right: 4px;
  }

  .show-icon::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    width: 10px;
    height: 10px;
    border: 2px solid currentColor;
    border-radius: 50%;
  }

  .show-icon::after {
    content: '';
    position: absolute;
    top: 5px;
    left: 5px;
    width: 4px;
    height: 4px;
    background: currentColor;
    border-radius: 50%;
  }

  .hide-icon::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(45deg);
    width: 12px;
    height: 2px;
    background: currentColor;
  }

  .hide-icon::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-45deg);
    width: 12px;
    height: 2px;
    background: currentColor;
  }

  /* Editor Organization Styles */
  .subsection {
    margin-bottom: 24px;
  }

  .subsection-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    margin: 0 0 12px 0;
    padding-bottom: 4px;
    border-bottom: 1px solid var(--line);
  }

  .option-management {
    background: var(--surface-1);
    border-radius: 8px;
    padding: 16px;
  }

  .option-controls {
    margin-bottom: 12px;
  }

  .preset-dropdown[open] summary {
    margin-bottom: 8px;
  }

  /* Drag and Drop Styles */
  .drag-handle {
    cursor: grab;
    padding: 8px 6px;
    color: var(--muted);
    font-size: 12px;
    line-height: 1;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
    margin-right: 8px;
  }

  .drag-handle:hover {
    background: var(--surface-3);
    color: var(--text);
  }

  .drag-handle:active {
    cursor: grabbing;
  }

  .option-row {
    transition: all 0.2s ease;
  }

  .option-row.dragging {
    opacity: 0.5;
    transform: scale(0.95);
    z-index: 1000;
  }

  .option-placeholder {
    background: var(--surface-3) !important;
    border: 2px dashed var(--accent) !important;
    border-radius: 8px !important;
    opacity: 0.7;
  }

  .option-editor-row {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* --- Pills & Tags --- */
  .pill {
    padding: 2px 8px;
    border: 1px solid var(--line);
    border-radius: 999px;
    font-size: 12px;
    display: inline-flex;
    align-items: center;
  }
  .tag {
    background: rgba(167, 181, 219, .25);
    color: var(--accent-weak);
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
  }

  /* --- Dropdown Menus --- */

  /* --- Input Groups --- */
  .input-group {
    display: inline-flex;
    align-items: center;
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    overflow: hidden;
  }
  .input-group label {
    padding: 8px 14px;
    background-color: var(--surface-2);
    color: var(--muted);
    font-weight: 500;
    border-right: 1px solid var(--line);
    white-space: nowrap;
  }
  .input-group select {
    border: none;
    border-radius: 0;
  }
  .input-group:focus-within {
    box-shadow: 0 0 0 3px var(--ring);
    border-color: transparent;
  }
  .input-group:focus-within select {
    box-shadow: none;
  }

  /* --- Toasts --- */
  #toastHost {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 2000;
    pointer-events: none;
  }
  #toastHost .toast {
    pointer-events: auto;
  }
  .toast {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    border: 1px solid var(--line);
    border-radius: 12px;
    background: var(--surface-1);
    box-shadow: var(--shadow);
    max-width: min(520px, 92vw);
  }
  .toast button {
    padding: 6px 10px;
    border-radius: 10px;
  }


  /* ===================================================================
    8. PAGE-SPECIFIC STYLES
    - Dashboard, Project Manager, Editor, Validator, etc.
    =================================================================== */

  /* --- Project Manager & Dashboard Cards --- */
  .project-card {
    display: flex;
    flex-direction: column;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-left: 4px solid var(--muted); /* Default color */
    transform: translateY(0);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1), 0 2px 6px rgba(0, 0, 0, 0.06);
  }

  /* Project status border colors */
  .project-card.status-draft {
    border-left-color: var(--muted); /* Gray for draft */
  }
  .project-card.status-pre-field {
    border-left-color: #7c3aed; /* Purple for pre-field */
  }
  .project-card.status-fielding {
    border-left-color: #16a34a; /* Green for fielding */
  }
  .project-card.status-reporting {
    border-left-color: #ea580c; /* Orange for reporting */
  }
  .project-card.status-waiting-for-approval {
    border-left-color: #d97706; /* Yellow for waiting approval */
  }
  .project-card.status-active {
    border-left-color: #059669; /* Emerald green for active */
  }
  .project-card.status-closed {
    border-left-color: #dc2626; /* Red for closed */
  }
  .project-card.status-archived {
    border-left-color: #6b7280; /* Gray for archived */
  }
  .project-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
    border-color: var(--accent);
  }
  .project-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: var(--space-5) var(--space-6);
    border-bottom: 1px solid var(--line);
  }
  .project-title-group {
    display: flex;
    flex-direction: column;
  }
  .project-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--fg);
  }
  .project-version {
    font-size: 0.8rem;
  }
  .project-favorite-btn:hover {
    background-color: var(--surface-3);
  }
  .project-card-content {
    flex-grow: 1;
    padding: var(--space-5) var(--space-6);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }
  .project-meta-item {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    color: var(--muted);
  }
  .project-meta-item svg {
    flex-shrink: 0;
    stroke-width: 2px;
    opacity: 0.8;
  }
  .project-tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    padding-top: var(--space-3);
  }
  .project-card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-4) var(--space-6);
    background-color: var(--surface-2);
    border-top: 1px solid var(--line);
    border-bottom-left-radius: var(--radius-lg);
    border-bottom-right-radius: var(--radius-lg);
  }

  /* Status dropdown styling to look like a pill */
  .status-selector-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
  }
  .status-selector-wrapper::after {
    content: '▾';
    position: absolute;
    right: 12px;
    pointer-events: none;
    color: var(--muted);
  }
  .status-selector {
    -webkit-appearance: none;
    -moz-appearance: none;  /* fix */
    appearance: none;
    background-color: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 999px;
    padding: 6px 32px 6px 14px;
    font-weight: 500;
    cursor: pointer;
  }
  .status-selector:focus {
    outline: none;
    box-shadow: 0 0 0 3px var(--ring);
    border-color: transparent;
  }
  .project-indicator, .project-selector-dropdown {
    max-width: 250px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .project-indicator {
    display: flex;
    align-items: center;
    padding: 4px 12px;
    background-color: var(--surface-3);
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    font-weight: 500;
    color: var(--muted);
  }
  .project-indicator:not(:empty) {
    border-color: var(--brand-secondary);
    color: var(--fg);
  }

  /* --- Workbench Container --- */
  .workbench {
    max-width: 1200px; /* Constrained width for better overview card layout */
    margin: 24px auto; /* Centered with top/bottom margin */
    padding: 0 24px; /* Horizontal padding for mobile */
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* --- Editor --- */
  #question-list .q-item {
    padding: 10px 12px;
    border: 1px solid var(--line);
    border-radius: 10px;
    background: var(--surface-1);
    cursor: grab;
    transition: border-color .12s, background .12s, box-shadow .12s;
    max-width: 100%;
  }
  #question-list .q-item + .q-item { margin-top: 8px; }
  #question-list .q-item:hover { border-color: var(--accent-weak); }
  #question-list .q-item.active {
    background: var(--surface-3);
    border-color: var(--accent-weak);
    box-shadow: 0 0 0 1px var(--accent-weak) inset;
  }
  #question-list .q-item .text {
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #question-list .q-item .summary {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
  }
  .editor-tabs {
    display: flex;
    gap: 6px;
    border-bottom: 1px solid var(--line);
    padding: 0 14px;
    background: var(--surface-1);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
  }
  .editor-tabs .tab {
    padding: 8px 12px;
    border: 1px solid transparent;
    border-bottom: 0;
    border-radius: 8px 8px 0 0;
    cursor: pointer;
    color: var(--muted);
    font-weight: 600;
  }
  .editor-tabs .tab.active {
    background: var(--surface-1);
    border-color: var(--line);
    color: var(--fg);
  }
  .editor-widget-bar {
      background: var(--surface-2);
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      padding: var(--space-2) var(--space-4); /* 8px 12px */
      margin-bottom: -1px; /* Neatly sits on top of the text area */
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
  }
  .editor-toolbar-container {
      border: 1px solid var(--line);
      border-radius: var(--radius-md) var(--radius-md) 0 0;
      background: var(--surface-2);
      margin-bottom: -1px; /* Sits flush on top of the textarea */
  }

  .toolbar-toggle-bar {
      padding: var(--space-2) var(--space-4); /* 8px 12px */
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--muted);
      font-weight: 600;
      font-size: 13px;
  }

  .toolbar-toggle-bar:hover {
      color: var(--fg);
  }

  .editor-toolbar {
    /* Styles for the collapsible area */
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 var(--space-4); /* No top/bottom padding when closed */
    max-height: 0;
    overflow: hidden;
    transition: all 0.25s ease-out;
  }
  .editor-toolbar.is-open {
    max-height: 80px; /* Animate to this height */
    padding-top: var(--space-3); /* 10px */
    padding-bottom: var(--space-3); /* 10px */
    border-top: 1px solid var(--line);
    margin-top: var(--space-2); /* 8px */
  }
  .editor-toolbar .form-control,
  .editor-toolbar .btn {
    padding-top: 4px;
    padding-bottom: 4px;
  }
  .editor-toolbar select.form-control {
    width: 100px; /* Makes the font size selector smaller */
  }

  /* Formatting button styles */
  .formatting-btn {
    width: 32px;
    height: 32px;
    padding: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    transition: all 0.2s ease;
    border-radius: var(--radius-sm);
  }

  .formatting-btn:hover {
    background: var(--surface-3);
    border-color: var(--accent-weak);
  }

  .formatting-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .formatting-btn.active:hover {
    background: var(--accent-weak);
  }


  .tab-content { display: none; }
  .tab-content.active { display: block; }
  #editor-panel:empty::before {
    content: "Select a question from the left to edit it, or add a new one.";
    color: var(--muted);
    background: var(--surface-1);
    border: 2px dashed var(--line);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    text-align: center;
    padding: 20px;
  }
  .option-editor-row {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    flex-wrap: nowrap;
    margin-bottom: var(--space-2);
  }
  .option-editor-row input[placeholder="Label"] { flex: 1 1 auto; min-width: 0; }
  .option-editor-row input[placeholder="Code"] { flex: 0 0 70px; }
  .option-editor-row input { padding-top: 8px; padding-bottom: 8px; }

  /* Numeric range editor styles */
  .numeric-range-editor-row {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    flex-wrap: wrap;
    margin-bottom: var(--space-2);
  }
  .numeric-range-editor-row input,
  .numeric-range-editor-row select {
    padding-top: 6px;
    padding-bottom: 6px;
    font-size: 13px;
  }

  .advanced-options .stack {
    background: transparent;
    padding: 0;
    border-radius: 0;
    border: none;
  }

  /* ==========================================================
   NEW ACCORDION SIDEBAR STYLES
   ========================================================== */
  /* The new single container for the whole sidebar */
/* ==========================================================
   POLISHED ACCORDION SIDEBAR STYLES
   ========================================================== */

  /* The new single container for the whole sidebar */
  .accordion-panel {
      background: var(--surface-1);
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      overflow: hidden;
  }

  /* The inner container for the items */
  .accordion-sidebar {
      display: flex;
      flex-direction: column;
  }

  /* Individual accordion items no longer have their own borders or shadows */
  .accordion-item {
      border-top: 1px solid var(--line);
      transition: background-color 0.2s ease-out;
  }
  .accordion-item:first-child {
      border-top: none; /* Remove divider for the very first item */
  }

  .accordion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      cursor: pointer;
      user-select: none;
      position: relative; /* For the active indicator */
  }

  /* Improved Hover State */
  .accordion-header:hover {
      background: var(--surface-3);
  }

  /* Clearer Active State */
  .accordion-item.active > .accordion-header {
      background-color: var(--brand-accent-3); /* A light blue/purple tint */
  }
  /* This is the key change: the colored left border */
  .accordion-item.active > .accordion-header::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background-color: var(--accent);
  }

  .accordion-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--fg);
  }

  .active .accordion-title {
      color: var(--accent); /* Keep the text color change */
  }

  .accordion-toggle-icon {
      transition: transform 0.25s ease-out;
      color: var(--muted);
  }
  .accordion-item.active .accordion-toggle-icon {
      color: var(--accent);
  }

  .is-expanded .accordion-toggle-icon {
      transform: rotate(180deg);
  }

  .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out, padding 0.3s ease-out;
      padding: 0 16px; /* Use slightly less padding */
      background: var(--surface-2); /* A slightly darker background to contain the content */
  }

  .is-expanded .accordion-content {
      max-height: 1000px; 
      padding: 16px 16px 20px;
      border-top: 1px solid var(--line);
  }

  /* --- Cleanup for Content INSIDE the accordion --- */
  /* These rules simplify the "Add Questions" and "Question List" cards */
  .is-expanded .sidebar-header-card,
  .is-expanded .question-list-card {
      border: none;
      box-shadow: none;
      background: transparent;
      padding: 0;
  }
  .is-expanded .question-list-header {
      background: transparent;
      padding: 0 0 12px 0;
  }

  /* START: Gantt Chart Styles */
  .gantt-chart-container {
    padding: 16px;
    overflow-x: auto;
  }
  .gantt-row {
    display: grid;
    grid-template-columns: 250px 1fr;
    border-bottom: 1px solid var(--line);
    align-items: center;
  }
  .gantt-row:first-of-type {
    border-top: 1px solid var(--line);
  }
  .gantt-header {
    font-weight: 600;
    background-color: var(--surface-2);
  }
  .gantt-label-cell {
    padding: 12px;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    border-right: 1px solid var(--line);
  }
  .gantt-timeline-cell {
    position: relative;
    padding: 12px 0;
    display: grid;
    grid-template-columns: repeat(12, 1fr); /* 12 months */
    border-right: 1px solid var(--line);
  }
  .gantt-month-marker {
    text-align: center;
    font-size: 12px;
    color: var(--muted);
    border-right: 1px solid var(--line);
    padding: 4px 0;
  }
  .gantt-month-marker:last-child {
    border-right: none;
  }
  .gantt-bar {
    position: absolute;
    height: 24px;
    background-color: var(--brand-blue-1);
    border-radius: 4px;
    border: 1px solid var(--brand-blue-2);
    color: white;
    font-size: 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 2px 8px;
    cursor: pointer;
    transition: filter 0.2s;
  }
  .gantt-bar:hover {
    filter: brightness(1.05);
  }



  /* START: Workload View Styles */
  .workload-view {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 16px;
    padding: 16px;
  }
  .workload-person-lane {
    background-color: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: var(--radius-lg);
    display: flex;
    flex-direction: column;
  }
  .workload-person-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid var(--line);
    background-color: var(--surface-2);
  }
  .workload-person-header h3 {
    margin: 0;
    font-size: 1.1rem;
  }
  .workload-cards-container {
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex-grow: 1; /* Allows the container to fill space */
  }
  .workload-card {
    background-color: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: var(--radius-md);
    padding: 12px;
    cursor: pointer;
    transition: box-shadow 0.2s;
  }
  .workload-card:hover {
    box-shadow: var(--shadow);
    border-color: var(--accent);
  }
  .workload-card-title {
    font-weight: 600;
    margin-bottom: 8px;
  }
  .workload-card-meta {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  /* END: Workload View Styles */
  /* ===================================================================
    9. LEGACY / FEATURE-SPECIFIC STYLES
    - Preview and Banner Builder styles are complex and scoped here.
    - They use some hardcoded colors and may not be fully theme-aware.
    =================================================================== */

  /* --- Preview Scaffolding (General) --- */
  .pv-wrap { padding: 16px 20px 28px; }
  .pv-header h2 { margin: 0; font-size: 20px; }
  .pv-sub { color: #666; margin-top: 2px; }
  .pv-sec { margin-top: 18px; }
  .pv-sec > h3 { margin: 12px 0 8px; font-size: 16px; }
  .pv-empty {
    padding: 10px 12px;
    color: #777;
    background: #f7f7fb;
    border: 1px solid #eee;
    border-radius: 8px;
  }
  .pv-row {
    display: grid;
    grid-template-columns: 90px 1fr;
    gap: 10px 14px;
    padding: 10px 12px;
    border: 1px solid #e5e8f1;
    border-radius: 12px;
    margin: 8px 0;
    background: #fff;
  }
  .pv-qid { font-weight: 600; color: #212161; align-self: start; }
  .pv-body { display: flex; flex-direction: column; gap: 6px; }
  .pv-title { font-weight: 600; }
  .pv-meta { display: flex; flex-wrap: wrap; gap: 8px 12px; align-items: center; }
  .pv-chip {
    display: inline-block;
    font-size: 12px;
    padding: 2px 8px;
    border-radius: 999px;
    background: #E3EAF7;
    color: #335899;
    border: 1px solid #A7B5DB;
  }
  .pv-tabs { display: flex; gap: 6px; margin: 12px 0; padding-left: 6px; }
  .pv-tab {
    padding: 8px 12px;
    border: 1px solid var(--line);
    border-radius: 999px;
    background: var(--surface-1);
    color: var(--muted);
    font-weight: 600;
    cursor: pointer;
  }
  .pv-tab.active { color: var(--fg); box-shadow: 0 0 0 2px var(--ring); }
  .pv-panel { display: none; }
  .pv-panel.active { display: block; }
  .pv-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
  .pv-table th, .pv-table td { border: 1px solid #e5e8f1; padding: 6px 8px; text-align: left; }

  /* --- Banner Builder Grid --- */
  .pv-banner-wrap {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  .pv-banner-grid {
    --pv-col-min: 160px;
    --pv-col-add: 60px;
    --pv-surface-1: #fff;
    --pv-border: #d9dbe0;
    --pv-h1-bg: #f6f7fb;
    --pv-stats-bg: #fafbfe;
    --pv-accent: #222;
    position: relative;
    display: grid;
    grid-auto-rows: auto;
  }
  .pv-banner-h1, .pv-banner-h2, .pv-banner-stats {
    display: contents !important;
  }
  .pv-banner-block {
    z-index: 0;
    pointer-events: none;
    background: var(--pv-surface-1);
    border-top: 1px solid var(--pv-border);
    border-bottom: 1px solid var(--pv-border);
    border-radius: 8px;
  }
  .pv-banner-cell {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 10px 12px;
    background: var(--pv-surface-1);
    border: 1px solid var(--pv-border);
    border-top: none;
    z-index: 1;
  }
  .pv-banner-stats .pv-banner-cell {
    background: var(--pv-stats-bg);
    font-size: 12px;
    color: #6b7280;
    justify-content: center;
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
  }
  .pv-banner-cell.pv-h1 {
    background: var(--pv-h1-bg);
    border-top: 1px solid var(--pv-border);
    border-bottom: 2px solid var(--pv-accent);
    font-weight: 600;
    justify-content: space-between;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
  }
  .pv-banner-h1 .pv-banner-cell { border-bottom: 1px solid var(--line) !important; }
  .pv-h1-text { padding-right: 8px; }
  .pv-banner-cell.pv-h2 { min-height: 56px; }
  .pv-h2-inner { display: flex; align-items: center; gap: 6px; width: 100%; }
  .pv-menu {
    margin-left: auto;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 2px 6px;
    opacity: .6;
    border-radius: 6px;
  }
  .pv-menu:hover { opacity: 1; background: rgba(0,0,0,.04); }
  .pv-add-cell {
    justify-content: center;
    min-height: 56px;
  }
  .pv-add-cell.pv-add-per-h1 { grid-row: span 2; }
  .pv-add-btn { border: none; background: transparent; cursor: pointer; }
  .pv-add-pill {
    border: 1px dashed var(--line);
    background: var(--surface-1);
    opacity: .95;
    border-radius: 999px;
    padding: 4px 10px;
  }
  .pv-add-pill:hover { opacity: 1; }
  .pv-editable { cursor: text; border-radius: 6px; padding: 2px 4px; }
  .pv-editable:focus-within { box-shadow: 0 0 0 2px var(--ring); outline: none; }
  .pv-inline-input {
    width: 100%;
    font: inherit;
    padding: 4px 6px;
    border: 1px solid var(--pv-border);
    border-radius: 6px;
    background: #fff;
  }
  .pv-cond-dot {
    position: absolute;
    right: 8px;
    bottom: 8px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--pv-accent);
    opacity: 0;
  }
  .pv-banner-cell.has-cond .pv-cond-dot { opacity: .9; }
  .pv-cell-menu {
    position: fixed;
    z-index: 1001;
    min-width: 220px;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 10px;
    box-shadow: var(--shadow);
    padding: 6px;
  }
  .pv-cell-menu .mitem {
    display: block;
    width: 100%;
    text-align: left;
    padding: 8px 10px;
    border-radius: 8px;
  }
  .pv-cell-menu .mitem:hover { background: var(--surface-3); }
  .pv-cell-menu .subhead {
    font-size: 12px;
    color: var(--muted);
    padding: 6px 10px 2px;
  }

  /* START: Timeline Styles */
  .timeline-view {
    padding: 24px;
  }
  .timeline-item {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 16px;
    padding: 16px 0;
    border-bottom: 1px solid var(--line);
  }
  .timeline-item:last-child {
    border-bottom: none;
  }
  .timeline-date {
    font-weight: 600;
    text-align: right;
    color: var(--muted);
    font-size: 13px;
  }
  .timeline-card {
    border-left: 3px solid var(--accent);
    padding-left: 16px;
  }
  .timeline-card-title {
    font-weight: 600;
    margin-bottom: 4px;
  }
  .timeline-card-meta {
    font-size: 13px;
    color: var(--muted);
  }
  /* END: Timeline Styles */

  /* ===================================================================
   NEW EDITOR UI STYLES (FROM MOCKUP)
   =================================================================== */

  /* Main Content Layout */
  .editor-main-content {
      display: grid;
      grid-template-columns: 360px 1fr; /* Sidebar + full-width main panel */
      gap: 24px;
      padding: 24px;
      /* Removed max-width to allow full window utilization */
      width: 100%;
  }

  /* Question List Sidebar */
  .question-sidebar {
      display: flex;
      flex-direction: column;
      gap: 16px;
      /* Remove max-height constraint to allow natural expansion */
  }

  .sidebar-header-card {
      background: var(--surface-1);
      border: 1px solid var(--line);
      border-radius: var(--radius-lg);
      padding: 20px;
      box-shadow: var(--shadow);
  }

  .sidebar-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 16px 0;
      color: var(--fg);
  }

  .add-question-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      width: 100%;
  }

  .add-btn {
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      background: var(--surface-2);
      color: var(--fg);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s ease;
  }

  /* Specific styles for question sidebar buttons */
  .add-question-grid .add-btn {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 40px;
      width: 100%;
      box-sizing: border-box;
  }

  .add-btn:hover {
      background: var(--accent);
      color: white;
      transform: translateY(-1px);
      border-color: var(--accent);
  }

  /* More dropdown styles */
  .more-dropdown {
      position: relative;
      width: 100%;
  }

  .more-btn {
      width: 100%;
  }

  .more-dropdown-content {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--surface-1);
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow);
      z-index: 1000;
      margin-top: 4px;
  }

  .more-dropdown-content.show {
      display: block;
  }

  .dropdown-option {
      width: 100%;
      padding: 10px 12px;
      border: none;
      background: transparent;
      color: var(--fg);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      text-align: left;
      transition: background-color 0.2s ease;
      border-radius: 0;
  }

  .dropdown-option:first-child {
      border-radius: var(--radius-md) var(--radius-md) 0 0;
  }

  .dropdown-option:last-child {
      border-radius: 0 0 var(--radius-md) var(--radius-md);
  }

  .dropdown-option:only-child {
      border-radius: var(--radius-md);
  }

  .dropdown-option:hover {
      background: var(--surface-2);
  }

  .question-list-card {
      background: var(--surface-1);
      border: 1px solid var(--line);
      border-radius: var(--radius-xl);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      overflow: hidden;
      transition: all 0.3s ease;
      margin-bottom: 16px;
  }

  .question-list-card:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
      border-color: var(--accent-weak);
  }

  .question-list-header {
      padding: 16px 24px;
      background: linear-gradient(135deg, var(--surface-2) 0%, var(--surface-3) 100%);
      border-bottom: 1px solid transparent;
      font-weight: 600;
      color: var(--fg);
      cursor: pointer;
      user-select: none;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
  }

  .question-list-header:hover {
      background: linear-gradient(135deg, var(--surface-3) 0%, rgba(33, 33, 97, 0.05) 100%);
      transform: translateY(-1px);
  }

  .question-list-header::after {
      content: '▶';
      font-size: 12px;
      color: var(--muted);
      transition: transform 0.3s ease;
  }

  .question-list-card.expanded .question-list-header {
      border-bottom-color: var(--line);
  }

  .question-list-card.expanded .question-list-header::after {
      transform: rotate(90deg);
  }

  .question-list-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease-out;
  }

  .question-list-card.expanded .question-list-body {
      max-height: 800px; /* Large enough for most question lists */
      overflow-y: auto;
  }

  .question-item {
      padding: 12px 16px;
      border-bottom: 1px solid var(--line);
      cursor: grab;
      transition: all 0.2s ease;
      position: relative;
  }

  .question-item:last-child { border-bottom: none; }
  .question-item:hover { background: var(--surface-3); }

  .question-item.active {
      background: var(--brand-accent-3);
      border-left: 4px solid var(--accent);
      padding-left: 12px;
  }

  .question-item .summary { /* Reusing your old class for the meta text */
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
  }
  /* Fixed styles for question text display */
  .question-item .text {
      font-weight: 500;
      color: var(--fg);
      line-height: 1.4;
      margin-bottom: 6px;
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
  }

  /* Stack layout within question items */
  .question-item .stack {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-bottom: 8px;
  }

  /* Summary row layout */
  .question-item .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
  }

  /* This is an OPTIONAL but recommended addition. 
    It ensures the layout doesn't break if a question ID tag is very long.
  */
  .question-item .tag {
      flex-shrink: 0; /* Prevents the tag from shrinking */
  }

  /* Conditional Logic Indicators */
  .question-item.has-conditions {
      border-left: 3px solid var(--accent);
  }
  .question-item.conditional-hidden {
      opacity: 0.6;
      border-left-color: var(--muted);
  }
  .condition-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      background: var(--surface-3);
      border: 1px solid var(--line);
  }
  .condition-icon {
      font-size: 10px;
  }
  .condition-status.visible {
      color: var(--accent);
      font-weight: 600;
  }
  .condition-status.hidden {
      color: var(--muted);
      font-weight: 600;
  }

  /* Editor Panel */
  .editor-panel-card {
      background: var(--surface-1);
      border: 1px solid var(--line);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      display: flex;
      flex-direction: column;
      overflow: visible;
  }

  .editor-header {
    padding: 16px 24px;
    background: var(--surface-2);
    border-bottom: 1px solid var(--line);
    display: flex;
    align-items: center;
    justify-content: space-between; /* <-- This pushes the title and buttons apart */
    overflow: visible;
  }

  .editor-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--fg);
  }
  .editor-title strong { color: var(--accent); }

  .editor-content {
      padding: 24px;
  }

  /* === COMPACT HEADER BAR === */
  .editor-header-compact {
    padding: 24px 32px;
    background: linear-gradient(135deg, var(--surface-1) 0%, var(--surface-2) 100%);
    border: 1px solid var(--line);
    border-radius: var(--radius-xl);
    margin-bottom: 24px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08), 0 2px 6px rgba(0, 0, 0, 0.04);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 24px;
    position: relative;
    overflow: hidden;
  }

  .editor-header-compact::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 120px;
    height: 120px;
    background: linear-gradient(45deg, rgba(33, 33, 97, 0.05) 0%, transparent 70%);
    border-radius: 50%;
    transform: translate(50%, -50%);
    pointer-events: none;
  }

  .question-basics-inline {
    display: flex;
    align-items: center;
    gap: 32px;
    position: relative;
    z-index: 1;
  }

  .question-id-group,
  .question-type-group {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: var(--radius-md);
    backdrop-filter: blur(8px);
  }

  .inline-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--muted);
    margin: 0;
  }

  .question-id-inline {
    width: 80px;
    padding: 6px 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--accent);
    border: 1px solid var(--line);
    border-radius: 4px;
    background: var(--surface-1);
  }

  .question-type-dropdown {
    min-width: 140px;
    padding: 6px 8px;
    font-size: 13px;
    border: 1px solid var(--line);
    border-radius: 4px;
    background: var(--surface-1);
    cursor: pointer;
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .compact-btn {
    padding: 8px 12px;
    font-size: 14px;
    min-width: auto;
  }

  .header-dropdown {
    position: relative;
    overflow: visible;
  }

  .dropdown-toggle::after {
    content: none; /* Remove default dropdown arrow */
  }

  .header-dropdown-menu {
    position: fixed;
    min-width: 180px;
    background: var(--surface-1);
    border: 1px solid var(--line);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    z-index: 9999;
  }

  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    font-size: 13px;
    color: var(--fg);
    text-decoration: none;
    transition: background-color 0.15s;
  }

  .dropdown-item:hover {
    background: var(--surface-3);
    color: var(--fg);
  }

  .dropdown-icon {
    font-size: 14px;
    width: 16px;
    text-align: center;
  }

  .dropdown-divider {
    height: 1px;
    background: var(--line);
    margin: 4px 0;
    border: none;
  }

  /* === COLLAPSIBLE SECTIONS FRAMEWORK === */
  .collapsible-section {
    margin-bottom: 24px;
    border: 1px solid var(--line);
    border-radius: var(--radius-xl);
    background: var(--surface-1);
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    transition: all 0.3s ease;
  }

  .collapsible-section:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    border-color: var(--accent-weak);
  }

  .collapsible-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    background: linear-gradient(135deg, var(--surface-2) 0%, var(--surface-3) 100%);
    border-bottom: 1px solid transparent;
    cursor: pointer;
    user-select: none;
    transition: all 0.3s ease;
    position: relative;
  }

  .collapsible-header:hover {
    background: linear-gradient(135deg, var(--surface-3) 0%, rgba(33, 33, 97, 0.05) 100%);
    transform: translateY(-1px);
  }

  .collapsible-section.expanded .collapsible-header {
    border-bottom-color: var(--line);
  }

  .collapsible-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 600;
    color: var(--fg);
    flex: 1;
  }

  .collapsible-header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .collapsible-header-actions .btn {
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 6px;
    border: 1px solid var(--line);
    background: var(--surface-1);
    color: var(--fg);
    transition: all 0.2s ease;
  }

  .collapsible-header-actions .btn:hover {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
    transform: translateY(-1px);
  }

  .collapsible-arrow {
    font-size: 12px;
    transition: transform 0.2s ease;
    color: var(--muted);
  }

  .collapsible-section.expanded .collapsible-arrow {
    transform: rotate(90deg);
  }

  .section-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 6px;
    font-size: 11px;
    font-weight: 500;
    background: var(--accent);
    color: white;
    border-radius: 12px;
    min-width: 16px;
    justify-content: center;
  }

  .section-status-badge.empty {
    background: var(--muted);
    opacity: 0.6;
  }

  .collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .collapsible-section.expanded .collapsible-content {
    max-height: 2000px; /* Large enough for most content */
  }

  .collapsible-inner {
    padding: 24px;
  }

  /* Always expanded sections (like Question Text) */
  .collapsible-section.always-expanded .collapsible-header {
    cursor: default;
    background: var(--surface-1);
    border-bottom: 1px solid var(--line);
  }

  .collapsible-section.always-expanded .collapsible-header:hover {
    background: var(--surface-1);
  }

  .collapsible-section.always-expanded .collapsible-arrow {
    display: none;
  }

  .collapsible-section.always-expanded .collapsible-content {
    max-height: none;
    overflow: visible;
  }

  /* === COMPACT OPTIONS EDITOR === */
  .option-row {
    margin-bottom: 4px !important; /* Reduce spacing between options */
  }

  .option-editor-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 4px;
    transition: all 0.15s;
  }

  .option-editor-row:hover {
    background: var(--surface-3);
    border-color: var(--accent-light);
  }

  .option-editor-row .drag-handle {
    color: var(--muted);
    cursor: grab;
    padding: 4px;
    font-size: 12px;
  }

  .option-editor-row .form-control {
    border: none;
    background: transparent;
    padding: 4px 6px;
    font-size: 13px;
  }

  .option-editor-row .form-control:focus {
    background: var(--surface-1);
    border: 1px solid var(--accent);
  }

  .option-editor-row .icon-btn {
    padding: 4px 6px;
    font-size: 12px;
    min-width: 24px;
    height: 24px;
  }

  /* Compact advanced options */
  .advanced-options {
    display: block;
    margin-top: 4px !important;
    padding: 0 !important;
    background: transparent;
    border-radius: 0;
    border: none;
    max-height: 1000px;
    opacity: 1;
    overflow: hidden;
    transition: max-height 0.3s ease-out, opacity 0.2s ease-out, margin-top 0.3s ease-out;
  }

  .advanced-options .stack {
    gap: 8px !important;
    width: 100%;
  }

  /* Ensure stack containing option-settings uses full width */
  .advanced-options .stack:has(.option-settings-container) {
    flex-direction: column;
    width: 100%;
  }

  .advanced-options label {
    font-size: 12px !important;
    margin: 0 !important;
  }

  .advanced-options .form-control {
    padding: 3px 6px !important;
    font-size: 12px !important;
  }

  /* Compact option controls toolbar */
  .option-controls {
    display: flex;
    align-items: center;
    gap: 6px !important;
    margin-bottom: 8px !important;
    padding: 6px 8px;
    background: var(--surface-2);
    border-radius: 4px;
    border: 1px solid var(--line);
  }

  .option-controls .btn {
    padding: 4px 8px;
    font-size: 12px;
    min-height: 28px;
  }

  /* Compact selection controls */
  .selection-controls {
    display: flex;
    gap: 4px;
    margin: 8px 0 !important;
  }

  .selection-option {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.15s;
  }

  .selection-option.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  .selection-option input[type="radio"] {
    display: none;
  }

  /* === OPTION SETTINGS PANEL === */
  .option-settings-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    padding: 16px;
    margin-bottom: 12px;
    background: var(--surface-1);
    border-radius: 8px;
    width: 100%;
    box-sizing: border-box;
  }

  .option-group-label-section {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .option-group-label-section label {
    font-size: 11px;
    font-weight: 500;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .option-group-label-section input {
    padding: 6px 8px;
    font-size: 13px;
    border: 1px solid var(--line);
    border-radius: 4px;
    background: var(--surface-1);
    width: 100%;
  }

  .option-group-label-section input:focus {
    border-color: var(--accent);
    outline: none;
    box-shadow: 0 0 0 1px rgba(var(--accent-rgb), 0.2);
  }

  .option-behaviors-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding-left: 16px;
    border-left: 1px solid var(--line);
  }

  .option-behaviors-section > label {
    font-size: 11px;
    font-weight: 500;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .behavior-toggle-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 8px;
  }

  .behavior-toggle-grid-full {
    grid-column: 1 / -1;
  }

  .behavior-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 6px;
    background: var(--surface-2);
    color: var(--fg);
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 12px;
    font-weight: 500;
    user-select: none;
  }

  .behavior-toggle:hover {
    background: var(--surface-3);
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .behavior-toggle.checked {
    background: var(--accent);
    color: white;
    box-shadow: 0 2px 8px rgba(var(--accent-rgb), 0.3);
  }

  .behavior-toggle.disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .behavior-toggle .icon {
    font-size: 12px;
    flex-shrink: 0;
  }

  .option-position-section {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 8px;
  }

  .option-position-section label {
    font-size: 11px;
    font-weight: 500;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0;
  }

  .option-position-section select {
    padding: 6px 8px;
    font-size: 12px;
    font-weight: 500;
    border: 1px solid var(--line);
    border-radius: 6px;
    background: var(--surface-2);
    color: var(--fg);
    max-width: 140px;
    cursor: pointer;
    transition: all 0.2s ease;
    appearance: none;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 8px center;
    background-repeat: no-repeat;
    background-size: 16px;
    padding-right: 32px;
  }

  .option-position-section select:hover {
    background: var(--surface-3);
    border-color: var(--accent);
  }

  .option-position-section select:focus {
    border-color: var(--accent);
    outline: none;
    box-shadow: 0 2px 4px rgba(var(--accent-rgb), 0.2);
    background: var(--surface-1);
  }

  /* Compact preferred toggle next to group label */
  .compact-preferred {
    flex-shrink: 0;
    min-width: auto;
    white-space: nowrap;
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 3px;
  }

  .compact-preferred .icon {
    font-size: 10px;
  }

  /* === COMPACT NUMERIC EDITOR === */
  .numeric-tabs {
    display: flex;
    margin-bottom: 16px;
    background: var(--surface-2);
    border-radius: 6px;
    padding: 4px;
    border: 1px solid var(--line);
  }

  .numeric-tab {
    flex: 1;
    text-align: center;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 500;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s;
    color: var(--muted);
  }

  .numeric-tab.active {
    background: var(--accent);
    color: white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }

  .numeric-tab input[type="radio"] {
    display: none;
  }

  .numeric-content {
    min-height: 120px;
  }

  .numeric-section {
    display: none;
  }

  .numeric-section.active {
    display: block;
  }

  .numeric-form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
    gap: 12px;
    margin-bottom: 12px;
  }

  .numeric-bottom-row {
    display: grid;
    grid-template-columns: 450px 140px 140px;
    gap: 12px;
    align-items: end;
    margin-top: 12px;
  }


  .numeric-form-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .numeric-form-group label {
    font-size: 11px;
    font-weight: 500;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .numeric-form-group .checkbox-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    color: var(--fg);
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
  }

  .numeric-form-group .checkbox-option:hover {
    background: var(--surface-3);
    border-color: var(--accent);
  }

  .numeric-form-group .checkbox-option input[type="checkbox"] {
    margin: 0;
    width: 14px;
    height: 14px;
    accent-color: var(--accent);
    cursor: pointer;
  }

  .numeric-form-group .checkbox-option.checked {
    background: rgba(var(--accent-rgb), 0.1);
    border-color: var(--accent);
    color: var(--accent);
  }

  .numeric-form-group input,
  .numeric-form-group select {
    padding: 6px 8px;
    font-size: 13px;
    border: 1px solid var(--line);
    border-radius: 4px;
    background: var(--surface-1);
  }

  .numeric-form-group input:focus,
  .numeric-form-group select:focus {
    border-color: var(--accent);
    outline: none;
  }

  /* Compact range editor */
  .numeric-range-row {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px;
    background: var(--surface-2);
    border: 1px solid var(--line);
    border-radius: 4px;
    margin-bottom: 4px;
  }

  .numeric-range-row input,
  .numeric-range-row select {
    border: none;
    background: transparent;
    padding: 3px 6px;
    font-size: 12px;
  }

  .numeric-range-row input:focus,
  .numeric-range-row select:focus {
    background: var(--surface-1);
    border: 1px solid var(--accent);
  }

  .numeric-range-controls {
    display: flex;
    gap: 6px;
    margin-bottom: 8px;
  }

  .numeric-range-controls .btn {
    padding: 4px 8px;
    font-size: 11px;
    min-height: 24px;
  }

  .editor-section {
      margin-bottom: 32px;
  }
  .editor-section:last-child { margin-bottom: 0; }

  .section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--fg);
      margin: 0 0 16px 0;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--line);
  }

  .form-row {
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 16px;
      align-items: start;
      margin-bottom: 16px;
  }
  .form-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
      padding-top: 10px;
      text-align: right;
  }

  /* Mode Selection Pills */
  .mode-selection {
    display: flex;
    width: 100%;
    gap: 4px;
    background: var(--surface-2);
    padding: 4px;
    border-radius: var(--radius-md);
    border: 1px solid var(--line);
  }
  .mode-btn {
    padding: 6px 16px;
    border: none;
    border-radius: var(--radius-sm);
    background: transparent;
    color: var(--muted);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .mode-btn.active {
    background: var(--surface-1);
    color: var(--accent);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  .mode-selection .mode-btn {
    flex-grow: 1; /* Allows each button to grow and fill the available space */
  }

  /* Options List Container */
  .options-content-area {
      background: var(--surface-2);
      border: 1px solid var(--line);
      border-radius: var(--radius-md);
      padding: 16px;
  }

  /* Updated Option Editor Row */
  .option-editor-row { /* Your existing class is fine, just needs a tweak */
      background: var(--surface-1);
      padding: 8px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--line);
  }

  /* --- Pre-Field Sub-Navigation Pills --- */
  .prefield-subnav-container {
      padding: 16px 0;
      display: flex;
      justify-content: center;
      background: var(--bg);
      border-bottom: 1px solid var(--line);
      position: sticky;
      top: 65px; /* Adjust if your main nav height changes */
      z-index: 49;
  }

  .prefield-pills {
      display: inline-flex;
      gap: 6px;
      background: var(--surface-2);
      padding: 6px;
      border-radius: var(--radius-md);
      border: 1px solid var(--line);
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.02);
  }

  .prefield-pill-btn {
      padding: 8px 20px;
      border: none;
      border-radius: var(--radius-sm);
      background: transparent;
      color: var(--muted);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
  }

  .prefield-pill-btn.active {
      background: var(--surface-1);
      color: var(--accent);
      box-shadow: var(--shadow);
  }

  .prefield-pill-btn:hover:not(.active) {
      background: rgba(0,0,0,0.02);
      color: var(--fg);
  }

  /* Bottom Sections Grid for Logic/Flow and Question Settings */
  .bottom-sections-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-top: 24px;
  }

  /* Responsive Adjustments */
  @media (max-width: 1200px) {
      .editor-main-content {
          grid-template-columns: 320px 1fr;
      }
  }
  @media (max-width: 900px) {
      .editor-main-content {
          grid-template-columns: 1fr;
      }
      .question-sidebar {
          max-height: none;
          position: static;
          top: auto;
      }
      /* Stack bottom sections on mobile */
      .bottom-sections-grid {
          grid-template-columns: 1fr;
          gap: 16px;
      }
  }

  /* START: Kanban Styles */
  .kanban-board {
    display: flex;
    gap: 16px;
    overflow-x: auto;
    padding: 16px;
    background-color: var(--surface-2);
    min-height: 60vh;
  }
  .kanban-column {
    flex: 0 0 320px; /* Each column has a fixed width */
    background-color: var(--surface-1);
    border-radius: var(--radius-lg);
    border: 1px solid var(--line);
    display: flex;
    flex-direction: column;
  }
  .kanban-column-header {
    padding: 12px 16px;
    font-weight: 600;
    border-bottom: 1px solid var(--line);
    background-color: var(--surface-2);
    border-top-left-radius: var(--radius-lg);
    border-top-right-radius: var(--radius-lg);
  }
  .kanban-cards {
    flex-grow: 1;
    padding: 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    min-height: 100px; /* Ensures drop zone is available even when empty */
  }
  .project-card.is-dragging {
    opacity: 0.5;
    transform: scale(0.98);
  }
  /* END: Kanban Styles */

  /* ===================================================================
    10. ACCESSIBILITY & OVERRIDES
    =================================================================== */
  :focus-visible {
    outline: none;
    box-shadow: 0 0 0 3px var(--ring);
    border-radius: 8px;
  }

  @media (prefers-reduced-motion: reduce) {
    * {
      animation: none !important;
      transition: none !important;
    }
  }


</style>
</head>
<body>

  <!-- App Header -->
  <header>
    <div class="actions">
      <div class="hamburger-nav-container">
        <button id="hamburger-nav-btn" class="hamburger-nav-btn" title="Navigation">
          <span class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
        <div id="hamburger-nav-dropdown" class="hamburger-nav-dropdown is-hidden">
          <div class="nav-section">
            <a href="#/dashboard" class="nav-item" data-route="#/dashboard">
              <span class="nav-icon">🏠</span>
              <span class="nav-label">Dashboard</span>
            </a>
            <a href="#/projects" class="nav-item" data-route="#/projects">
              <span class="nav-icon">📊</span>
              <span class="nav-label">Projects Manager</span>
            </a>
            <a href="#/profile" class="nav-item" data-route="#/profile">
              <span class="nav-icon">👤</span>
              <span class="nav-label">Profile</span>
            </a>
          </div>
          <div class="nav-section coming-soon">
            <div class="nav-section-label">Coming Soon</div>
            <div class="nav-item disabled">
              <span class="nav-icon">📅</span>
              <span class="nav-label">Calendar</span>
            </div>
            <div class="nav-item disabled">
              <span class="nav-icon">📈</span>
              <span class="nav-label">Analytics</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <a href="#/dashboard" id="logo-link" title="Go to Dashboard">
      <img src="/assets/images/cue_logo/Cue Logo 2.png" alt="Cue Insights" class="logo" />
      <span>Q-Gen Tab Planner</span>
    </a>
    
    <div class="actions">
      <div id="project-name-indicator"></div>
      <div id="status" class="status-msg"></div>
      <div class="global-settings-container">
        <button id="global-settings-btn" class="global-settings-btn" title="App Settings">
          ⚙️
        </button>
        <div id="global-settings-dropdown" class="global-settings-dropdown is-hidden">
          <div class="settings-section">
            <label>Theme</label>
            <div class="theme-options">
              <button class="theme-option" data-theme="cue-light">
                <span class="theme-preview light-preview"></span>
                Light
              </button>
              <button class="theme-option" data-theme="cue-dark">
                <span class="theme-preview dark-preview"></span>
                Dark
              </button>
              <button class="theme-option" data-theme="cue-gold">
                <span class="theme-preview gold-preview"></span>
                Gold
              </button>
            </div>
          </div>
          <div class="settings-section">
            <label>More Settings</label>
            <button class="settings-item" id="advanced-settings-btn">
              🔧 Advanced Settings
            </button>
            <button class="settings-item" id="about-btn">
              ℹ️ About
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- This is the main container where your router will render views -->
  <main id="view-root"></main>

  <!-- Global error display -->
  <div id="serverError" class="error is-hidden"></div>

  <!-- Footer -->
  <footer class="app-footer-zoned" style="background: var(--surface-1); border-top: 1px solid var(--line); padding: 15px 25px; font-size: 13px;">
    <div class="footer-container" style="display: flex; justify-content: space-between; align-items: center; max-width: 1800px; margin: 0 auto;">
        <div class="footer-left">
            © 2025 <strong>QGEN</strong> by <a href="https://www.cueinsights.com/" target="_blank">Cue Insights</a>
        </div>
        <div class="footer-right">
            <span>v3.0.0</span>
        </div>
    </div>
  </footer>

  <!-- Main application entry point -->
  <script type="module" src="/src/main.js"></script>

  <!-- Global Settings & Hamburger Navigation Handler -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Global Settings Elements
      const globalSettingsBtn = document.getElementById('global-settings-btn');
      const globalSettingsDropdown = document.getElementById('global-settings-dropdown');
      const themeOptions = document.querySelectorAll('.theme-option');
      const advancedSettingsBtn = document.getElementById('advanced-settings-btn');
      const aboutBtn = document.getElementById('about-btn');

      // Hamburger Navigation Elements
      const hamburgerNavBtn = document.getElementById('hamburger-nav-btn');
      const hamburgerNavDropdown = document.getElementById('hamburger-nav-dropdown');
      const navItems = document.querySelectorAll('.nav-item:not(.disabled)');

      // Toggle dropdown on click
      globalSettingsBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        globalSettingsDropdown.classList.toggle('is-hidden');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.global-settings-container')) {
          globalSettingsDropdown.classList.add('is-hidden');
        }
      });

      // Theme switching functionality
      themeOptions.forEach(option => {
        option.addEventListener('click', () => {
          const selectedTheme = option.dataset.theme;

          // Update document theme
          document.documentElement.setAttribute('data-theme', selectedTheme);

          // Update active state
          themeOptions.forEach(opt => opt.classList.remove('active'));
          option.classList.add('active');

          // Save theme preference
          localStorage.setItem('selectedTheme', selectedTheme);

          // Close dropdown
          globalSettingsDropdown.classList.add('is-hidden');
        });
      });

      // Set initial active theme
      const currentTheme = document.documentElement.getAttribute('data-theme') || 'cue-light';
      const activeThemeOption = document.querySelector(`[data-theme="${currentTheme}"]`);
      if (activeThemeOption) {
        activeThemeOption.classList.add('active');
      }

      // Load saved theme preference
      const savedTheme = localStorage.getItem('selectedTheme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
        const savedThemeOption = document.querySelector(`[data-theme="${savedTheme}"]`);
        if (savedThemeOption) {
          themeOptions.forEach(opt => opt.classList.remove('active'));
          savedThemeOption.classList.add('active');
        }
      }

      // Advanced settings handler
      advancedSettingsBtn.addEventListener('click', () => {
        alert('Advanced Settings - Coming Soon!\n\nThis will include:\n• Export/Import settings\n• Keyboard shortcuts\n• Performance options\n• Developer tools');
        globalSettingsDropdown.classList.add('is-hidden');
      });

      // About handler
      aboutBtn.addEventListener('click', () => {
        alert('Q-Gen Tab Planner v3.0.0\n\nDeveloped by Cue Insights\n\nNext-generation market research platform for the AI-driven future.');
        globalSettingsDropdown.classList.add('is-hidden');
      });

      // Hamburger Navigation Functionality
      hamburgerNavBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        hamburgerNavDropdown.classList.toggle('is-hidden');
        hamburgerNavBtn.classList.toggle('active');
      });

      // Close hamburger dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.hamburger-nav-container')) {
          hamburgerNavDropdown.classList.add('is-hidden');
          hamburgerNavBtn.classList.remove('active');
        }
      });

      // Handle navigation item clicks
      navItems.forEach(item => {
        item.addEventListener('click', () => {
          // Close dropdown
          hamburgerNavDropdown.classList.add('is-hidden');
          hamburgerNavBtn.classList.remove('active');

          // Update active state (will be handled by router)
          navItems.forEach(nav => nav.classList.remove('active'));
          item.classList.add('active');
        });
      });

      // Update active nav item based on current route
      function updateActiveNavItem() {
        const currentHash = window.location.hash;
        navItems.forEach(item => {
          item.classList.remove('active');
          const route = item.getAttribute('data-route') || item.getAttribute('href');
          if (route && currentHash.startsWith(route)) {
            item.classList.add('active');
          }
        });
      }

      // Update active nav on load and hash change
      updateActiveNavItem();
      window.addEventListener('hashchange', updateActiveNavItem);
    });
  </script>

</body>
</html>
